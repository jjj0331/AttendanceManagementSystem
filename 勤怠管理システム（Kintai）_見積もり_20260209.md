# 勤怠管理システム（Kintai） 工数見積もり

## 基本情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | 勤怠管理システム（Kintai） |
| 見積日 | 2026-02-09 |
| 設計書バージョン | Phase 3 + Phase 3.5 完了（Round 2 設計 + P0修正済み） |
| 見積もり設定 | docs/.context/estimate-config.yaml |

---

## エグゼクティブサマリー

| 区分 | 工数（人日） |
|------|------------|
| Backend基本工数 | 141.1 |
| Frontend基本工数 | 207.2 |
| **基本工数 合計** | **348.3** |
| スコープ補正（×1.0） | - |
| 品質補正（×1.04） | - |
| チーム補正（×1.0） | - |
| **補正工数** | **361.0** |
| バッファ（20%） | 72.2 |
| **見積総計** | **433.2** |

| 区分 | 金額 |
|------|------|
| 人月換算 | 21.7人月 |
| 人月単価 | 80万円（1人月 = 20日） |
| **見積金額（税抜）** | **¥17,327,000** |

> 金額は1,000円未満切上。

---

## 集約別内訳

| 集約 | API | DB | 画面 | コンポ (有効) | 連携 | 状態遷移 | フォーム | チャート | テーブル | 小計 |
|------|-----|-----|------|-------------|------|---------|---------|---------|---------|------|
| 勤怠記録 | 6.5 | 13.6 | 8.0 | 19.5 (65.0) | 2.25 | 2.4 | 0.3 | 0.0 | 1.5 | 54.05 |
| シフト | 5.0 | 10.4 | 8.0 | 9.3 (31.0) | 2.25 | 2.1 | 1.2 | 0.0 | 1.0 | 39.25 |
| 残業申請 | 3.5 | 6.5 | 8.0 | 16.2 (54.0) | 2.25 | 1.8 | 0.9 | 0.0 | 1.0 | 40.15 |
| 休暇申請 | 3.5 | 7.2 | 8.0 | 19.65 (65.5) | 2.25 | 2.1 | 0.9 | 0.0 | 1.0 | 44.6 |
| 打刻修正申請 | 4.5 | 7.3 | 10.0 | 23.25 (77.5) | 2.25 | 2.4 | 1.8 | 0.0 | 1.5 | 53.0 |
| 有給残高 | 4.5 | 14.4 | 6.0 | 18.0 (60.0) | 2.25 | 1.2 | 0.9 | 1.0 | 1.0 | 49.25 |
| 月次締め | 2.5 | 9.2 | 4.0 | 15.3 (51.0) | 2.25 | 1.5 | 0.3 | 0.0 | 1.0 | 36.05 |
| 通知 | 3.0 | 7.1 | 6.0 | 11.1 (37.0) | 2.25 | 0.9 | 0.6 | 0.0 | 1.0 | 31.95 |
| **合計** | **33.0** | **75.7** | **58.0** | **132.3 (441.0)** | **18.0** | **14.4** | **6.9** | **1.0** | **9.0** | **348.3** |

> コンポーネント有効化率: 0.5
> （ツリーノード 882 × 有効化率 0.5 = 有効コンポーネント 441.0）

---

## メトリクス詳細

### API メトリクス（信頼度: ⭐⭐⭐⭐⭐）

| 集約 | エンドポイント数 | エラーコード数 | 認可パターン数 |
|------|---------------|-------------|-------------|
| 勤怠記録 | 13 | 34 | 13 |
| シフト | 10 | 23 | 10 |
| 残業申請 | 7 | 21 | 7 |
| 休暇申請 | 7 | 20 | 7 |
| 打刻修正申請 | 9 | 29 | 9 |
| 有給残高 | 9 | 24 | 9 |
| 月次締め | 5 | 13 | 6 |
| 通知 | 6 | 16 | 6 |
| **合計** | **66** | **180** | **67** |

### DB メトリクス（信頼度: ⭐⭐⭐⭐）

| 集約 | エンティティ数 | カラム数 | 制約数 | インデックス数 | ビュー数 |
|------|-------------|--------|--------|-------------|--------|
| 勤怠記録 | 6 | 76 | 18 | 17 | 1 |
| シフト | 4 | 64 | 22 | 11 | 0 |
| 残業申請 | 3 | 35 | 10 | 11 | 0 |
| 休暇申請 | 3 | 42 | 11 | 12 | 0 |
| 打刻修正申請 | 3 | 43 | 13 | 12 | 0 |
| 有給残高 | 7 | 74 | 24 | 25 | 1 |
| 月次締め | 4 | 52 | 15 | 16 | 0 |
| 通知 | 3 | 41 | 12 | 12 | 0 |
| **合計** | **33** | **427** | **125** | **116** | **2** |

### 画面 メトリクス（信頼度: ⭐⭐⭐）

| 集約 | 画面数 | コンポーネント数 | 有効コンポーネント数 | チャート数 | テーブル数 | フォーム数 |
|------|--------|-------------|---------------|---------|---------|---------|
| 勤怠記録 | 4 | 130 | 65.0 | 0 | 3 | 1 |
| シフト | 4 | 62 | 31.0 | 0 | 2 | 4 |
| 残業申請 | 4 | 108 | 54.0 | 0 | 2 | 3 |
| 休暇申請 | 4 | 131 | 65.5 | 0 | 2 | 3 |
| 打刻修正申請 | 5 | 155 | 77.5 | 0 | 3 | 6 |
| 有給残高 | 3 | 120 | 60.0 | 1 | 2 | 3 |
| 月次締め | 2 | 102 | 51.0 | 0 | 2 | 1 |
| 通知 | 3 | 74 | 37.0 | 0 | 2 | 2 |
| **合計** | **29** | **882** | **441.0** | **1** | **18** | **23** |

### ドメイン メトリクス（信頼度: ⭐⭐⭐）

| 集約 | 状態数 | 遷移数 |
|------|--------|--------|
| 勤怠記録 | 5 | 8 |
| シフト | 6 | 7 |
| 残業申請 | 6 | 6 |
| 休暇申請 | 5 | 7 |
| 打刻修正申請 | 7 | 8 |
| 有給残高 | 4 | 4 |
| 月次締め | 5 | 5 |
| 通知 | 3 | 3 |
| **合計** | **41** | **48** |

### コンテキスト間連携メトリクス

| パターン | 件数 |
|---------|------|
| Sagaオーケストレーション | 4 |
| 同期クエリ | 4 |
| ドメインイベント | 1 |
| **合計** | **9** |

---

## 補正係数

### A. 設計品質係数（加法合成・自動算出）

| 項目 | Δ値 | 算出根拠 |
|------|-----|---------|
| 設計完成度 | -0.1 | design-review 92.2% >= 80% |
| エラー密度 | +0.14 | min(0.2, 2.73 × 0.05) = min(0.2, 0.14) |
| **品質係数** | **1.04** | 1.0 + (-0.1) + 0.14 |

> **除外済み項目（二重計上防止）:**
> - 状態遷移複雑度 → 基本工数の `state_transition` で計上済み
> - 連携複雑度 → 基本工数の `context_integration` で計上済み

### B. スコープ係数（クライアント要件・estimate-config.yaml）

| 項目 | 選択値 | 係数 |
|------|--------|------|
| リアルタイム | なし | 1.0 |
| 国際化 | 単一言語 | 1.0 |
| テストレベル | +統合テスト | 1.0 |
| **合成値** | | **1.0** |

> **除外済み項目（開発チーム内部の技術選定）:**
> - アーキテクチャ（CRUD/DDD/ES+CQRS）
> - フロントエンド構成（テンプレート/SPA/SSR）
> - 認証方式（セッション/OAuth2）
>
> これらのリスクは `team_factors.tech_proficiency` で吸収する。

### C. チーム係数（estimate-config.yaml）

| 項目 | 値 | 備考 |
|------|-----|------|
| 技術習熟度 | 1.0 | 標準的な習熟度 |
| ドメイン知識 | 1.0 | 標準的な知識 |
| チーム規模オーバーヘッド | 1.0 | 1〜3名 |
| **合成値** | **1.0** | |

### 補正係数合成

| 係数 | 値 |
|------|-----|
| A × B × C | 1.04 |
| 安全弁適用後 | **1.04**（安全弁: 5.0） |

---

## 前回比較

| 項目 | 前回（02-07） | 今回（02-09） | 差分 |
|------|-------------|-------------|------|
| 対象集約数 | 4 | 8 | +4 |
| 基本工数 | 122.7人日 | 348.3人日 | +225.6（+183.9%） |
| 補正工数 | 135.0人日 | 361.0人日 | +226.0（+167.4%） |
| 見積総計 | 162.0人日 | 433.2人日 | +271.2（+167.5%） |
| 見積金額 | ¥6,479,000 | ¥17,327,000 | +¥10,848,000 |

### 主な変動要因

- **スコープ拡大（支配的要因）**: 4集約 → 8集約（シフト・休暇申請・打刻修正申請・通知を追加）。基本工数の増加の大半はこれによる
- **設計品質向上**: 品質係数 1.1 → 1.04。design-review P0修正により設計完成度が向上し、エラー密度も 4.06 → 2.73 に改善
- **コンテキスト間連携**: 8件 → 9件（Phase 3.5 で Saga 2→4件、Query 追加）
- **メトリクス精緻化**: Round 2 設計でAPI・画面設計を全8集約に対して実施。前回は設計初期の暫定値を含んでいた

---

## 実装フェーズ提案

### 集約間依存関係

```
勤怠記録 ←── 打刻修正申請
   ↑           ↑
シフト      残業申請

有給残高 ←── 休暇申請

月次締め ←── (全集約の実績データ)
通知     ←── (全集約のイベント)
```

### フェーズ構成

#### Phase 1: 日次打刻基盤（パイロット稼働）

| 集約 | 基本工数 | 概要 |
|------|---------|------|
| 勤怠記録 | 54.1 | 出退勤打刻・勤務実績管理 |
| シフト | 39.3 | シフト作成・割当・公開 |
| **小計** | **93.3** | |

- 認証基盤・共通UI・DB基盤を含む初期構築
- **この時点でパイロット運用を開始可能**

#### Phase 2: 勤怠修正・残業管理

| 集約 | 基本工数 | 概要 |
|------|---------|------|
| 打刻修正申請 | 53.0 | 打刻忘れ・誤打刻の修正申請 |
| 残業申請 | 40.2 | 残業の事前申請・事後承認 |
| **小計** | **93.2** | |

- 勤怠記録に依存 → Phase 1 完了後に着手
- 承認ワークフローの共通基盤をここで確立

#### Phase 3: 休暇管理

| 集約 | 基本工数 | 概要 |
|------|---------|------|
| 有給残高 | 49.3 | 有給付与・消化・残日数管理 |
| 休暇申請 | 44.6 | 各種休暇の申請・承認 |
| **小計** | **93.9** | |

- 有給残高 → 休暇申請の順で実装（残高参照の依存）
- Phase 2 の承認ワークフロー基盤を再利用

#### Phase 4: 月次集計・通知

| 集約 | 基本工数 | 概要 |
|------|---------|------|
| 月次締め | 36.1 | 月次勤怠集計・確定・CSV出力 |
| 通知 | 32.0 | アプリ内通知・未読管理 |
| **小計** | **68.0** | |

- 月次締めは全集約の実績が揃って初めて機能する → 最終フェーズ
- 通知もイベント発行元が出揃った状態で本格稼働

### フェーズ別概算

| フェーズ | 基本工数 | 補正+バッファ後 | 金額目安 | 累計金額 |
|---------|---------|---------------|---------|---------|
| Phase 1: 打刻基盤 | 93.3 | ~116 | ~¥4.6M | ¥4.6M |
| Phase 2: 修正・残業 | 93.2 | ~116 | ~¥4.6M | ¥9.2M |
| Phase 3: 休暇管理 | 93.9 | ~117 | ~¥4.7M | ¥13.9M |
| Phase 4: 月次・通知 | 68.0 | ~85 | ~¥3.4M | ¥17.3M |
| **合計** | **348.3** | **~433** | **¥17.3M** | |

### フェーズ分けの設計方針

1. **Phase 1 でパイロット稼働** — 最小構成で早期にユーザーフィードバックを取得
2. **Phase 1〜3 がほぼ均等**（各 ~93人日）— 予算・リソース計画が組みやすい
3. **承認ワークフロー基盤を Phase 2 で確立** — Phase 3 の休暇申請で再利用し効率化
4. **集計・通知を最終フェーズに配置** — 全データが揃った状態で開発・検証
5. **フェーズ間で段階的に Go/No-Go 判断が可能** — Phase 1 完了時点で本格展開の判断ができる

---

## 前提条件

- 技術スタック: Next.js 16.x (SSR+SPA) + Spring Boot 4.x (DDD) + PostgreSQL 16.x
- 対象範囲: 8集約（勤怠記録・シフト・残業申請・休暇申請・打刻修正申請・有給残高・月次締め・通知）+ コンテキスト間連携9件
- 設計書完成度: Phase 3 + Phase 3.5 完了（design-review 92.2%、P0残1件）
- 見積もり単価: estimate-config.yaml の unit_prices に基づく
- コンポーネント有効化率: 0.5（ツリーノードの50%を実装対象と算定）

---

## 除外事項

- インフラ構築・運用（AWS ECS Fargate、RDS等）
- CI/CDパイプライン構築（GitHub Actions）
- 外部サービス連携のアカウント発行・契約（Google Workspace OAuth設定等）
- データ移行
- ユーザー教育・マニュアル作成
- プロジェクトマネジメント工数

---

## 再見積もり条件

以下の変更が発生した場合、`/estimate` の再実行を推奨:

- エンドポイント数の増減（±20%以上）
- 新規コンテキストの追加
- チーム構成の変更
- 要件の大幅な変更（集約の追加・削除）
- リアルタイム・多言語・テストレベル等のスコープ要件変更
