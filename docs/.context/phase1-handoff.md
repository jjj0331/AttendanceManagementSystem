# Phase 1 → Phase 2 申し送り

## 完了サマリー

勤怠管理システムの5コンテキスト（コア3 + 支援1 + 汎用1）、8集約のイベントストーミング図をMermaid形式で生成。コンテキスト間連携（Saga）は主要4パターンを図示した。

## 次のPhaseへの入力

### 集約一覧と主要フロー要約

| コンテキスト | 集約 | コマンド数 | イベント数 | リードモデル数 |
|-------------|------|----------|----------|-------------|
| 勤怠管理 | 勤怠記録 | 6 | 7 | 3 |
| 勤怠管理 | シフト | 3 | 3 | 2 |
| 申請承認 | 残業申請 | 4 | 4 | 0 |
| 申請承認 | 休暇申請 | 4 | 4 | 0 |
| 申請承認 | 打刻修正申請 | 3 | 3 | 0 |
| 休暇管理 | 有給残高 | 3 | 3 | 2 |
| 休暇管理 | 休暇付与 | 1 | 1 | 0 |
| 月次処理 | 月次締め | 3 | 3 | 1 |

### 主要Saga

1. 休暇承認 → 有給消化 + 勤怠更新 + カレンダー同期
2. 打刻修正承認 → 勤怠記録修正 + 勤務時間再計算
3. 残業承認 → 残業確定 + 36協定チェック
4. 月次本締め → 勤怠確定 + 給与エクスポート

## 未確定事項

- [ ] 通知コンテキストの詳細設計（理由: 汎用コンテキストのため、具体的な通知チャネル・テンプレートはPhase 3で決定）
- [ ] 休暇付与集約を有給残高集約に統合するか（理由: Phase 0.5 から継続、モデリング時に判断）

## 注意点

- **申請承認コンテキスト**がハブとして3つのSagaの起点。ドメインモデリングでは申請の共通パターン（状態遷移: 下書き→申請中→承認済/却下→再申請中）を抽象化できるか検討
- **勤怠記録集約**が最も複雑（コマンド6、イベント7）。勤務時間計算のドメインロジック（3種の勤務パターン×割増率）が集約の中核
- **有給残高集約**は3つの自動ポリシー（付与・消化・時効）を持つ。タイミング制御（入社日起算、2年時効）がドメインロジックの核心
- 月次締め集約の**冪等性**要件を忘れないこと（本締め処理の途中中断→再実行）
