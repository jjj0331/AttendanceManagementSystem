# 打刻修正申請一覧

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-CC-001 |
| 画面種別 | 一覧 |
| 関連集約 | 打刻修正申請（申請承認コンテキスト） |
| URL | `/clock-corrections` |

---

## ワイヤーフレーム

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 申請管理 > 打刻修正申請一覧                           │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────┐ │
│ │ 検索条件                                                             │ │
│ │                                                                     │ │
│ │ 対象期間   [2026/02/01] ～ [2026/02/28]                             │ │
│ │ ステータス [全件                      ▼]                             │ │
│ │                                                                     │ │
│ │                                          [クリア]  [■ 検索 ■]       │ │
│ └───────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────┤
│ 件数: 8件                                       [■ + 打刻修正申請 ■]   │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌──────────┬────────┬──────────────────┬──────────┬────────┬────┐       │
│ │ 対象日 ▼ │修正種別│ 修正前→修正後    │ 申請日 ▼ │ステータス│ ⚠ │       │
│ ├──────────┼────────┼──────────────────┼──────────┼────────┼────┤       │
│ │ 02/10(月)│ 退勤   │ 17:00 → 18:30   │ 02/10    │[申請中]│    │       │
│ │ 02/08(土)│ 出勤   │ --:-- → 09:00   │ 02/09    │[上長済]│    │       │
│ │ 02/07(金)│ 両方   │ 09:30/17:00     │ 02/08    │[人事待]│ ⚠ │       │
│ │          │        │  → 09:00/18:00  │          │        │    │       │
│ │ 02/05(水)│ 退勤   │ 17:30 → 19:00   │ 02/06    │[完了]  │    │       │
│ │ 02/03(月)│ 出勤   │ 09:15 → 09:00   │ 02/03    │[却下]  │ ⚠ │       │
│ └──────────┴────────┴──────────────────┴──────────┴────────┴────┘       │
├───────────────────────────────────────────────────────────────────────────┤
│ < 1 2 3 >                                             20件/ページ ▼   │
└───────────────────────────────────────────────────────────────────────────┘
```

---

## コンポーネント構成

```
ClockCorrectionListPage
├── Breadcrumb
│   └── BreadcrumbItem ("ホーム", "申請管理", "打刻修正申請一覧")
├── SearchForm (上部固定)
│   ├── DateRangePicker (対象期間)
│   ├── StatusSelect (ステータス)
│   └── ButtonGroup
│       ├── ClearButton (クリア)
│       └── SearchButton (検索)
├── ActionBar
│   ├── ResultCount (検索結果件数)
│   └── CreateButton ("+ 打刻修正申請" → 打刻修正申請作成画面へ)
├── DataTable
│   ├── TableHeader (ソート可: 対象日, 申請日)
│   ├── TableRow (クリックで詳細画面へ遷移)
│   │   ├── TargetDateCell (対象日 + 曜日)
│   │   ├── CorrectionTypeCell (修正種別: 出勤/退勤/両方)
│   │   ├── ClockTimeDiffCell (修正前→修正後 時刻差分)
│   │   ├── RequestedAtCell (申請日)
│   │   ├── StatusBadge (ステータスバッジ)
│   │   └── ProvisionalCloseWarning (仮締め後フラグ ⚠)
│   └── EmptyState ("該当する打刻修正申請がありません")
└── Pagination
    ├── PageNumbers
    └── PageSizeSelector (20件/ページ)
```

---

## 表示項目

### 一覧カラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|------|------|
| targetDate | 対象日 | date | ✅ | 120px | MM/DD(曜) 形式 |
| correctionType | 修正種別 | text | - | 80px | 出勤/退勤/両方 |
| clockTimeDiff | 修正前→修正後 | text | - | 180px | HH:mm → HH:mm 形式 |
| requestedAt | 申請日 | date | ✅ (デフォルト降順) | 100px | MM/DD 形式 |
| status | ステータス | badge | - | 100px | 色分けバッジ |
| afterProvisionalClose | 仮締め後 | icon | - | 40px | ⚠ アイコン（該当時のみ表示） |

### 修正種別表示

| 値 | 表示 | 備考 |
|----|------|------|
| CLOCK_IN | 出勤 | 出勤打刻のみ修正 |
| CLOCK_OUT | 退勤 | 退勤打刻のみ修正 |
| BOTH | 両方 | 出勤・退勤両方を修正 |

### 修正前→修正後（clockTimeDiff）表示ルール

| 修正種別 | 表示形式 | 例 |
|---------|---------|-----|
| 出勤 | `{旧出勤} → {新出勤}` | `09:15 → 09:00` |
| 退勤 | `{旧退勤} → {新退勤}` | `17:00 → 18:30` |
| 両方 | `{旧出勤}/{旧退勤}` + 改行 + `→ {新出勤}/{新退勤}` | `09:30/17:00` → `09:00/18:00` |
| 打刻なし→追加 | `--:-- → {新時刻}` | `--:-- → 09:00` |

### ステータスバッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| SUBMITTED | 申請中 | blue-700 | blue-100 |
| MGR_APPROVED | 上長済 | indigo-700 | indigo-100 |
| PENDING_HR | 人事待 | amber-700 | amber-100 |
| COMPLETED | 完了 | green-700 | green-100 |
| REJECTED | 却下 | red-700 | red-100 |

### 仮締め後フラグ

| 条件 | 表示 | 備考 |
|------|------|------|
| afterProvisionalClose = true | ⚠ (amber-500) | ツールチップ: 「仮締め後の修正申請です」 |
| afterProvisionalClose = false | - (非表示) | |

---

## 検索条件

| 条件 | フィールド名 | 入力形式 | 演算子 | デフォルト | 備考 |
|------|-------------|---------|--------|-----------|------|
| 対象期間 | targetDate | 日付範囲 (DateRange) | BETWEEN | 当月 (1日〜末日) | カレンダーピッカー |
| ステータス | status | セレクト (CorrectionStatus) | = | 全件 | 5種+全件 |

### ステータスセレクトの選択肢

| 値 | 表示 |
|----|------|
| (空) | 全件 |
| SUBMITTED | 申請中 |
| MGR_APPROVED | 上長承認済 |
| PENDING_HR | 人事確認待ち |
| COMPLETED | 完了 |
| REJECTED | 却下 |

### 従業員IDの暗黙パラメータ

API呼び出し時に `employeeId` をクエリパラメータとして付与する。
画面上にはセレクトを表示せず、権限に応じて以下のように制御する。

| 権限 | 挙動 |
|------|------|
| 本人 | ログインユーザーのIDを自動付与 |
| 上長 | 配下社員を閲覧可（別途社員切替UIを将来追加） |
| 人事 | 全社員を閲覧可（別途社員切替UIを将来追加） |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 検索 | 検索ボタン | 検索条件で一覧再取得 | read (本人+上長+人事) |
| クリア | クリアボタン | 検索条件をデフォルトに戻す | read |
| 打刻修正申請 | + 打刻修正申請ボタン | 打刻修正申請作成画面へ遷移 | write (本人のみ) |
| ソート変更 | カラムヘッダークリック | ソート条件変更 + 一覧再取得 | read |
| ページ切替 | ページネーション操作 | ページ変更 + 一覧再取得 | read |

### 行アクション

| アクション | 処理 | 備考 |
|-----------|------|------|
| 行クリック | 打刻修正申請詳細画面へ遷移 | 全ロール共通 |

---

## 状態管理

```typescript
/** 打刻修正申請ステータス */
type CorrectionStatus =
  | 'SUBMITTED'
  | 'MGR_APPROVED'
  | 'PENDING_HR'
  | 'COMPLETED'
  | 'REJECTED';

/** 修正種別 */
type CorrectionType =
  | 'CLOCK_IN'
  | 'CLOCK_OUT'
  | 'BOTH';

/** ソート方向 */
type SortOrder = 'asc' | 'desc';

/** ソート可能カラム */
type SortableColumn =
  | 'targetDate'
  | 'requestedAt';

/** 打刻修正申請一覧アイテム */
interface ClockCorrectionItem {
  clockCorrectionRequestId: string;  // 打刻修正申請ID
  employeeId: string;                // 申請者ID
  employeeName: string;              // 申請者名（従業員マスタから導出）
  targetDate: string;                // ISO 8601 date
  correctionType: CorrectionType;
  originalClockIn: string | null;    // HH:mm or null
  originalClockOut: string | null;   // HH:mm or null
  correctedClockIn: string | null;   // HH:mm or null
  correctedClockOut: string | null;  // HH:mm or null
  status: CorrectionStatus;
  requestedAt: string;               // ISO 8601 datetime
  afterProvisionalClose: boolean;
}

/** 検索パラメータ */
interface SearchParams {
  employeeId: string;                // デフォルト: ログインユーザー
  dateFrom: string;                  // ISO 8601 date、デフォルト: 当月1日
  dateTo: string;                    // ISO 8601 date、デフォルト: 当月末日
  status: CorrectionStatus | null;   // null = 全件
}

/** ページネーション */
interface PaginationState {
  page: number;                      // 現在ページ (0-based)
  size: number;                      // 1ページあたり件数 (デフォルト: 20)
  sort: SortableColumn;              // ソートカラム (デフォルト: requestedAt)
  order: SortOrder;                  // ソート方向 (デフォルト: desc)
}

/** 画面全体の状態 */
interface ClockCorrectionListState {
  /** 検索条件 */
  searchParams: SearchParams;

  /** ページネーション */
  pagination: PaginationState;

  /** データ */
  data: {
    content: ClockCorrectionItem[];
    page: {
      number: number;
      size: number;
      totalElements: number;
      totalPages: number;
    };
    isLoading: boolean;
    error: {
      message: string;
      retryAction: (() => void) | null;
    } | null;
  };
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------|
| 一覧取得 | `/api/v1/clock-corrections` | GET | employeeId, dateFrom, dateTo, status, page, size, sort |

### リクエスト例

```
GET /api/v1/clock-corrections
  ?employeeId=EMP-001
  &dateFrom=2026-02-01
  &dateTo=2026-02-28
  &status=
  &page=0
  &size=20
  &sort=requestedAt,desc
```

### レスポンス例

```json
{
  "content": [
    {
      "clockCorrectionRequestId": "CC-20260210-EMP001",
      "targetDate": "2026-02-10",
      "correctionType": "CLOCK_OUT",
      "originalClockIn": "09:00",
      "originalClockOut": "17:00",
      "correctedClockIn": null,
      "correctedClockOut": "18:30",
      "status": "SUBMITTED",
      "requestedAt": "2026-02-10T10:00:00+09:00",
      "afterProvisionalClose": false
    },
    {
      "clockCorrectionRequestId": "CC-20260207-EMP001",
      "targetDate": "2026-02-07",
      "correctionType": "BOTH",
      "originalClockIn": "09:30",
      "originalClockOut": "17:00",
      "correctedClockIn": "09:00",
      "correctedClockOut": "18:00",
      "status": "PENDING_HR",
      "requestedAt": "2026-02-08T09:30:00+09:00",
      "afterProvisionalClose": true
    }
  ],
  "page": {
    "number": 0,
    "size": 20,
    "totalElements": 8,
    "totalPages": 1
  }
}
```

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | リダイレクト | ログイン画面へ |
| 権限エラー | 403 | Toast (error) | 「この社員の打刻修正申請を閲覧する権限がありません」 |
| バリデーションエラー | 400 | Toast (warning) | 検索条件の修正を促す |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | フル表示（全6カラム） |
| Tablet (768-1024px) | 修正前→修正後カラム省略表示、仮締め後カラム非表示（4カラム） |
| Mobile (<768px) | カード形式に切り替え（対象日+修正種別+ステータス+仮締め後フラグ） |

### Mobile カード形式

```
┌──────────────────────────────────┐
│ 02/10(月) 退勤          [申請中] │
│ 17:00 → 18:30                   │
├──────────────────────────────────┤
│ 02/07(金) 両方       ⚠ [人事待] │
│ 09:30/17:00 → 09:00/18:00      │
├──────────────────────────────────┤
│ 02/05(水) 退勤          [完了]   │
│ 17:30 → 19:00                   │
└──────────────────────────────────┘
```

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ページ背景 |
| サーフェスカラー | #F9FAFB (gray-50) | 検索フォーム背景 |
| テキスト: Primary | #111827 (gray-900) | 見出し・データ値 |
| テキスト: Secondary | #6B7280 (gray-500) | ラベル・補足 |
| ボーダー | #E5E7EB (gray-200) | テーブル罫線・区切り |
| アクセントカラー | #2563EB (blue-600) | Primary ボタン・ソートアイコン |
| バッジ: 申請中 | blue-100 / blue-700 | SUBMITTED |
| バッジ: 上長済 | indigo-100 / indigo-700 | MGR_APPROVED |
| バッジ: 人事待 | amber-100 / amber-700 | PENDING_HR |
| バッジ: 完了 | green-100 / green-700 | COMPLETED |
| バッジ: 却下 | red-100 / red-700 | REJECTED |
| 仮締め後アイコン | #F59E0B (amber-500) | ⚠ アイコン色 |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| ページタイトル | system-ui | 24px | 700 | パンくず下 |
| 検索ラベル | system-ui | 12px | 500 | 検索条件ラベル |
| テーブルヘッダー | system-ui | 12px | 600 | カラム名 |
| テーブルデータ | system-ui | 14px | 400 | セルデータ |
| 時刻表示 | monospace | 14px | 400 | HH:mm 形式を等幅で |
| 矢印記号 | system-ui | 14px | 400 | → 記号 |
| バッジテキスト | system-ui | 12px | 500 | ステータス文字列 |
| 件数表示 | system-ui | 14px | 400 | 「8件」 |
| ボタンラベル | system-ui | 14px | 500 | 検索・打刻修正申請 |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| ページ左右パディング | 24px |
| 検索フォーム: パディング | 16px |
| 検索フォーム: 角丸 | 8px |
| セクション間余白 | 16px |
| テーブル行高 | 48px (両方の場合は 64px) |
| ボタン角丸 | 6px |
| ボタン高さ | 36px |
| バッジ角丸 | 12px (pill) |
| バッジパディング | 2px 10px |
| カード影 | なし（clean-minimal） |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------|
| テーブル行: ホバー | 背景色 gray-50 + カーソル pointer |
| ソートヘッダー: ホバー | テキスト色 blue-600 + カーソル pointer |
| ソートヘッダー: アクティブ | ▲/▼ アイコン表示 + テキスト色 blue-600 |
| ボタン: ホバー | 背景色 5% 暗く |
| ボタン: disabled | opacity: 0.4 |
| フォーカス | 2px outline (blue-600) + 2px offset |
| ローディング | テーブル部分に Skeleton UI（5行分） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| ページネーション: ホバー | 背景色 gray-100 |
| ページネーション: 現在ページ | 背景色 blue-600 + テキスト白 |
| 仮締め後アイコン: ホバー | ツールチップ表示 |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- テーブルのゼブラストライプ（clean-minimalでは罫線のみ）
- 検索条件の過度な装飾（シンプルなフォームで十分）

---

## 品質チェック結果

- [x] 全クエリに対応する表示要素がある（6カラムのDataTable、2条件の検索フォーム、ページネーション）
- [x] 全コマンドに対応する操作UIがある（「+ 打刻修正申請」ボタン → 作成画面遷移、行クリック → 詳細画面遷移）
- [x] エラー状態の表示が定義されている（Toast通知 + 再試行ボタン、権限エラー対応）
- [x] 状態遷移がUI上で表現されている（5種のステータスバッジで色分け表示 + 仮締め後⚠フラグ）

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 一覧
コンポーネント数: 16
DataTable: 1
SearchForm: 1
フォーム数: 1
チャート数: 0
-->
