# 残業申請詳細

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-OT-002 |
| 画面種別 | 詳細 |
| 関連集約 | 残業申請（申請承認コンテキスト） |
| URL | `/overtime-requests/{id}` |

---

## ワイヤーフレーム

### SUBMITTED 状態（上長が閲覧時）

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 申請管理 > 残業申請一覧 > 残業申請詳細               │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│ 残業申請詳細                                          [申請中]          │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 申請情報                                                           │ │
│ │                                                                   │ │
│ │ 残業対象日       2026/02/10 (月)                                   │ │
│ │ 予定残業時間     1時間30分                                         │ │
│ │ 残業理由         月末レポート作成のため残業が必要です               │ │
│ │ 申請日時         2026/02/10 09:00                                  │ │
│ │ 申請者           山田太郎 (EMP-001)                                │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 承認/却下                                                         │ │
│ │                                                                   │ │
│ │ 却下理由  [                                               ]       │ │
│ │           ※却下する場合のみ入力 (10-500文字)                       │ │
│ │                                                                   │ │
│ │                              [却下する]  [■ 承認する ■]           │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 操作履歴                                                           │ │
│ │                                                                   │ │
│ │ 2026/02/10 09:00  山田太郎  申請                                   │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ [← 一覧に戻る]                                                         │
│                                                                         │
└───────────────────────────────────────────────────────────────────────────┘
```

### REJECTED 状態（申請者が閲覧時）

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 申請管理 > 残業申請一覧 > 残業申請詳細               │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│ 残業申請詳細                                            [却下]          │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 申請情報                                                           │ │
│ │                                                                   │ │
│ │ 残業対象日       2026/02/05 (水)                                   │ │
│ │ 予定残業時間     1時間00分                                         │ │
│ │ 残業理由         システム障害対応のため残業が必要です               │ │
│ │ 申請日時         2026/02/05 17:00                                  │ │
│ │ 申請者           山田太郎 (EMP-001)                                │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 却下情報                                                           │ │
│ │                                                                   │ │
│ │ 却下者           鈴木部長 (MGR-001)                                │ │
│ │ 却下理由         当該業務は翌日の通常勤務時間内で対応可能と判断    │ │
│ │ 却下日時         2026/02/05 18:30                                  │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 再申請                                                             │ │
│ │                                                                   │ │
│ │ 予定残業時間  [ 0:45 ▼]                                           │ │
│ │ 残業理由      [業務範囲を見直し、最小限の残業で対応します    ]     │ │
│ │              ※10-200文字                                           │ │
│ │                                                                   │ │
│ │                                          [■ 再申請する ■]         │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 操作履歴                                                           │ │
│ │                                                                   │ │
│ │ 2026/02/05 18:30  鈴木部長  却下                                   │ │
│ │ 2026/02/05 17:00  山田太郎  申請                                   │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ [← 一覧に戻る]                                                         │
│                                                                         │
└───────────────────────────────────────────────────────────────────────────┘
```

### APPROVED 状態（閲覧のみ）

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 申請管理 > 残業申請一覧 > 残業申請詳細               │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│ 残業申請詳細                                          [承認済]          │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 申請情報                                                           │ │
│ │                                                                   │ │
│ │ 残業対象日       2026/02/07 (金)                                   │ │
│ │ 予定残業時間     2時間00分                                         │ │
│ │ 残業理由         顧客提出資料の最終確認と修正                     │ │
│ │ 申請日時         2026/02/07 08:30                                  │ │
│ │ 申請者           山田太郎 (EMP-001)                                │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 承認情報                                                           │ │
│ │                                                                   │ │
│ │ 承認者           鈴木部長 (MGR-001)                                │ │
│ │ 承認日時         2026/02/07 10:30                                  │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 操作履歴                                                           │ │
│ │                                                                   │ │
│ │ 2026/02/07 10:30  鈴木部長  承認                                   │ │
│ │ 2026/02/07 08:30  山田太郎  申請                                   │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ [← 一覧に戻る]                                                         │
│                                                                         │
└───────────────────────────────────────────────────────────────────────────┘
```

---

## コンポーネント構成

```
OvertimeRequestDetailPage
├── Breadcrumb
│   └── BreadcrumbItem ("ホーム", "申請管理", "残業申請一覧", "残業申請詳細")
├── PageHeader
│   ├── Title ("残業申請詳細")
│   └── StatusBadge (現在のステータス)
├── RequestInfoSection
│   ├── DefinitionList
│   │   ├── TargetDate (残業対象日)
│   │   ├── PlannedOvertime (予定残業時間)
│   │   ├── Reason (残業理由)
│   │   ├── RequestedAt (申請日時)
│   │   └── EmployeeName (申請者)
├── ApprovalSection (SUBMITTED + 上長のみ表示)
│   ├── RejectionReasonInput (却下理由テキストエリア)
│   └── ButtonGroup
│       ├── RejectButton (却下する)
│       └── ApproveButton (承認する)
├── RejectionInfoSection (REJECTED のみ表示)
│   ├── DefinitionList
│   │   ├── ApproverName (却下者)
│   │   ├── RejectionReason (却下理由)
│   │   └── DecidedAt (却下日時)
├── ApprovalInfoSection (APPROVED のみ表示)
│   ├── DefinitionList
│   │   ├── ApproverName (承認者)
│   │   └── DecidedAt (承認日時)
├── ResubmitSection (REJECTED + 申請者本人のみ表示)
│   ├── PlannedOvertimeSelect (予定残業時間)
│   ├── ReasonTextarea (残業理由)
│   └── ResubmitButton (再申請する)
├── OperationHistory
│   └── HistoryList
│       └── HistoryItem (日時 + 操作者 + 操作)
├── BackLink ("← 一覧に戻る")
└── ToastNotification (操作結果通知)
```

---

## 表示項目

### 申請情報

| 項目 | 表示名 | 型 | フォーマット | 備考 |
|------|--------|-----|-------------|------|
| targetDate | 残業対象日 | date | YYYY/MM/DD (曜) | - |
| plannedOvertime | 予定残業時間 | duration | N時間MM分 | 分→時間分変換 |
| reason | 残業理由 | text | - | 全文表示 |
| requestedAt | 申請日時 | datetime | YYYY/MM/DD HH:mm | - |
| employeeName | 申請者 | text | 氏名 (社員ID) | - |

### 承認/却下情報（決定済みの場合）

| 項目 | 表示名 | 型 | フォーマット | 備考 |
|------|--------|-----|-------------|------|
| approverName | 承認者/却下者 | text | 氏名 (管理者ID) | - |
| rejectionReason | 却下理由 | text | - | REJECTED のみ |
| decidedAt | 承認日時/却下日時 | datetime | YYYY/MM/DD HH:mm | - |

### ステータスバッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| DRAFT | 下書き | gray-700 | gray-100 |
| SUBMITTED | 申請中 | blue-700 | blue-100 |
| APPROVED | 承認済 | green-700 | green-100 |
| REJECTED | 却下 | red-700 | red-100 |

---

## アクション

### 条件付きアクションセクション

| アクション | トリガー | 表示条件 | 処理 | 権限 |
|-----------|---------|---------|------|------|
| 承認する | 承認ボタン | status=SUBMITTED | approve API 実行 → ステータス更新 | 上長のみ |
| 却下する | 却下ボタン | status=SUBMITTED | reject API 実行（却下理由必須） → ステータス更新 | 上長のみ |
| 再申請する | 再申請ボタン | status=REJECTED | resubmit API 実行 → ステータス更新 | 申請者本人のみ |
| 一覧に戻る | 戻るリンク | 常時 | 残業申請一覧 (SCR-OT-001) へ遷移 | 全ロール |

### 承認・却下時の確認ダイアログ

| アクション | ダイアログ | メッセージ |
|-----------|----------|-----------|
| 承認する | 確認ダイアログ | 「この残業申請を承認しますか？」 |
| 却下する | 確認ダイアログ | 「この残業申請を却下しますか？」 |
| 再申請する | 確認ダイアログ | 「修正内容で再申請しますか？」 |

---

## 状態管理

```typescript
/** 申請ステータス */
type RequestStatus =
  | 'DRAFT'
  | 'SUBMITTED'
  | 'APPROVED'
  | 'REJECTED';

/** 残業申請詳細データ */
interface OvertimeRequestDetail {
  overtimeRequestId: string;
  employeeId: string;
  employeeName: string;
  targetDate: string;              // ISO 8601 date
  plannedOvertime: number;         // 分
  reason: string;
  status: RequestStatus;
  approverId: string | null;
  approverName: string | null;
  rejectionReason: string | null;
  requestedAt: string;             // ISO 8601 datetime
  decidedAt: string | null;        // ISO 8601 datetime
}

/** 操作履歴 */
interface OperationHistoryItem {
  occurredAt: string;              // ISO 8601 datetime
  operatorName: string;
  eventType: string;               // SUBMITTED / APPROVED / REJECTED / RESUBMITTED
}

/** 再申請フォーム */
interface ResubmitForm {
  plannedOvertime: number;         // 分（15分単位）
  reason: string;                  // 10-200文字
}

/** 画面全体の状態 */
interface OvertimeRequestDetailState {
  /** 詳細データ */
  data: {
    request: OvertimeRequestDetail | null;
    history: OperationHistoryItem[];
    isLoading: boolean;
    error: {
      message: string;
      retryAction: (() => void) | null;
    } | null;
  };

  /** 承認/却下セクション（上長のみ） */
  approvalSection: {
    rejectionReason: string;       // 却下理由入力値
    isSubmitting: boolean;
  };

  /** 再申請セクション（申請者のみ） */
  resubmitSection: {
    form: ResubmitForm;
    isSubmitting: boolean;
    validationErrors: Record<string, string>;
  };

  /** 確認ダイアログ */
  confirmDialog: {
    isOpen: boolean;
    action: 'approve' | 'reject' | 'resubmit' | null;
  };
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------|
| 詳細取得 | `/api/v1/overtime-requests/{id}` | GET | - |
| 承認 | `/api/v1/overtime-requests/{id}/actions/approve` | POST | approverId |
| 却下 | `/api/v1/overtime-requests/{id}/actions/reject` | POST | approverId, rejectionReason |
| 再申請 | `/api/v1/overtime-requests/{id}/actions/resubmit` | POST | plannedOvertime, reason |

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | リダイレクト | ログイン画面へ |
| 権限エラー | 403 | Toast (error) | 「この操作を行う権限がありません」 |
| 申請不存在 | 404 | Toast (error) + リダイレクト | 一覧画面へ |
| 状態不整合 | 409 | Toast (warning) | 「申請の状態が変更されています」 + 再取得 |
| バリデーションエラー | 400 | フォーム内エラー表示 | 各フィールド下にエラーメッセージ |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | フル表示（セクション横並びなし、縦積み） |
| Tablet (768-1024px) | 同上（レイアウト変更なし） |
| Mobile (<768px) | パディング縮小、ボタン幅 100% |

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ページ背景 |
| サーフェスカラー | #F9FAFB (gray-50) | セクション背景 |
| テキスト: Primary | #111827 (gray-900) | 見出し・データ値 |
| テキスト: Secondary | #6B7280 (gray-500) | ラベル・補足 |
| ボーダー | #E5E7EB (gray-200) | セクション区切り |
| アクセントカラー | #2563EB (blue-600) | Primary ボタン（承認・再申請） |
| Danger カラー | #DC2626 (red-600) | 却下ボタン |
| バッジ: 下書き | gray-100 / gray-700 | DRAFT |
| バッジ: 申請中 | blue-100 / blue-700 | SUBMITTED |
| バッジ: 承認済 | green-100 / green-700 | APPROVED |
| バッジ: 却下 | red-100 / red-700 | REJECTED |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| ページタイトル | system-ui | 24px | 700 | パンくず下 |
| セクション見出し | system-ui | 18px | 600 | 申請情報・承認情報等 |
| 定義リスト: ラベル | system-ui | 12px | 500 | 「残業対象日」等 |
| 定義リスト: 値 | system-ui | 14px | 400 | データ値 |
| 時刻表示 | monospace | 14px | 400 | 日時データ |
| ボタンラベル | system-ui | 14px | 500 | 承認・却下・再申請 |
| 履歴テキスト | system-ui | 13px | 400 | 操作履歴行 |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| ページ左右パディング | 24px |
| セクション: パディング | 20px |
| セクション: 角丸 | 8px |
| セクション: ボーダー | 1px solid #E5E7EB |
| セクション間余白 | 20px |
| 定義リスト: ラベル幅 | 140px |
| 定義リスト: 行間 | 12px |
| ボタン角丸 | 6px |
| ボタン高さ | 40px |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------|
| ボタン: ホバー | 背景色 5% 暗く |
| ボタン: disabled | opacity: 0.4 |
| ボタン: 送信中 | スピナー表示、全ボタン disabled |
| フォーカス | 2px outline (blue-600) + 2px offset |
| 確認ダイアログ | 中央モーダル（オーバーレイ付き） |
| ローディング | Skeleton UI（セクション単位） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- アクションボタンの配置を状態によって移動させる（固定位置が望ましい）

---

## 品質チェック結果

- [x] 全クエリに対応する表示要素がある（申請情報・承認情報・操作履歴の全項目を表示）
- [x] 全コマンドに対応する操作UIがある（承認・却下・再申請の3アクション + 確認ダイアログ）
- [x] エラー状態の表示が定義されている（Toast通知 + 再試行、状態不整合時の再取得）
- [x] 状態遷移がUI上で表現されている（ステータスバッジ + 状態別セクション表示切替）

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 詳細
コンポーネント数: 20
DataTable: 0
SearchForm: 0
フォーム数: 2
チャート数: 0
-->
