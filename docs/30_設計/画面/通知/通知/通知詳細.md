# 通知詳細

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-NTF-003 |
| 画面種別 | 詳細 |
| 関連集約 | 通知（通知コンテキスト） |
| URL | `/notifications/{id}` |

---

## ワイヤーフレーム

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 通知一覧 > 通知詳細                                   │
│                                                                         │
│ 通知詳細                                                                │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────┐ │
│ │ メタ情報                                                             │ │
│ │                                                                     │ │
│ │ 重要度     [■高■]          既読状態   [●未読]                         │ │
│ │ 送信日時   2026/02/10 09:30                                         │ │
│ │ 発信元     勤怠管理         種別       36協定アラート                 │ │
│ └───────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────┐ │
│ │ タイトル                                                             │ │
│ │                                                                     │ │
│ │ 36協定の上限に近づいています                                         │ │
│ ├───────────────────────────────────────────────────────────────────────┤ │
│ │ 本文                                                                 │ │
│ │                                                                     │ │
│ │ 今月の残業時間が36協定の上限の80%に達しました。                       │ │
│ │ 残りの稼働可能時間を確認し、業務調整を行ってください。               │ │
│ │ 詳細は勤怠管理画面をご確認ください。                                 │ │
│ └───────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────┐ │
│ │ 外部配信                                                             │ │
│ │                                                                     │ │
│ │ 配信チャネル   Slack           配信済み   ✔                          │ │
│ └───────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                                    [◁ 戻る]  [■ 既読にする ■]           │
│                                                                         │
└───────────────────────────────────────────────────────────────────────────┘
```

### ワイヤーフレーム補足

| セクション | 説明 |
|-----------|------|
| ヘッダー | システム名 + ユーザーメニュー |
| パンくず | ホーム > 通知一覧 > 通知詳細 |
| メタ情報 | 重要度バッジ・既読状態バッジ・送信日時・発信元・通知種別を横2列で配置 |
| タイトル＋本文 | 通知タイトルを見出しとし、本文を自然文で表示 |
| 外部配信 | 配信チャネルと配信済みフラグを表示 |
| アクションバー | 「戻る」ボタン（左寄せ）と「既読にする」ボタン（右寄せ） |

---

## コンポーネント構成

```
NotificationDetailPage
├── Breadcrumb
│   └── BreadcrumbItem ("ホーム", "通知一覧", "通知詳細")
├── PageHeader
│   └── PageTitle ("通知詳細")
├── MetaInfoSection
│   ├── ImportanceBadge (重要度バッジ: 高/中/低)
│   ├── ReadStatusBadge (既読状態バッジ: 未読/既読)
│   ├── SentAtLabel (送信日時)
│   ├── SourceContextLabel (発信元)
│   └── NotificationTypeLabel (通知種別)
├── ContentSection
│   ├── NotificationTitle (タイトル表示)
│   └── NotificationBody (本文表示)
├── ExternalDeliverySection
│   ├── DeliveryChannelLabel (配信チャネル)
│   └── DeliveryStatusIcon (配信済みアイコン: ✔/−)
├── ActionBar
│   ├── BackButton ("◁ 戻る" → 通知一覧へ)
│   └── MarkAsReadButton ("既読にする" ※未読時のみ活性)
└── LoadingState
    └── SkeletonDetail (読み込み中プレースホルダー)
```

---

## 表示項目

### 詳細フィールド

| フィールド | 表示名 | 型 | 表示形式 | 備考 |
|-----------|--------|-----|---------|------|
| type | 通知種別 | NotificationType | テキストラベル | enum→表示名変換 |
| importance | 重要度 | Importance | バッジ | 色分け (赤/黄/灰) |
| title | タイトル | NotificationTitle | 見出しテキスト | h3相当 |
| body | 本文 | NotificationBody | 複数行テキスト | 改行保持・リンク自動変換 |
| sourceContext | 発信元 | SourceContext | テキストラベル | enum→表示名変換 |
| readStatus | 既読状態 | ReadStatus | バッジ | 色分け (青/灰) |
| readAt | 既読日時 | DateTime | 日時テキスト | 未読時は非表示 |
| externalChannel | 外部配信 | DeliveryChannel | テキストラベル | NONE時は「−」 |
| externalDelivered | 外部配信済み | boolean | アイコン | ✔ または − |
| sentAt | 送信日時 | DateTime | 日時テキスト | YYYY/MM/DD HH:mm |

### 通知種別（NotificationType）

| 値 | 表示名 |
|----|--------|
| ARTICLE36_ALERT | 36協定アラート |
| UNAPPLIED_OVERTIME_ALERT | 未申請残業アラート |
| APPROVAL_REMINDER | 承認リマインダー |
| APPROVAL_URGENCY | 承認緊急催促 |
| CLOCK_FORGOT | 打刻忘れ通知 |
| SHIFT_CHANGE | シフト変更通知 |
| SPECIAL_LEAVE_GRANT | 特別休暇付与通知 |
| LEAVE_EXPIRY_WARNING | 有給期限警告 |
| LEAVE_OBLIGATION_ALERT | 有給取得義務アラート |

### 重要度バッジ（Importance）

| 値 | 表示 | テキスト色 | 背景色 |
|----|------|-----------|--------|
| HIGH | 高 | red-700 | red-100 |
| MEDIUM | 中 | yellow-700 | yellow-100 |
| LOW | 低 | gray-700 | gray-100 |

### 既読状態バッジ（ReadStatus）

| 値 | 表示 | テキスト色 | 背景色 |
|----|------|-----------|--------|
| UNREAD | 未読 | blue-700 | blue-100 |
| READ | 既読 | gray-700 | gray-100 |

### 発信元（SourceContext）

| 値 | 表示名 |
|----|--------|
| ATTENDANCE | 勤怠管理 |
| APPROVAL | 申請承認 |
| LEAVE | 休暇管理 |
| MONTHLY | 月次処理 |

### 外部配信チャネル（DeliveryChannel）

| 値 | 表示名 |
|----|--------|
| NONE | − |
| SLACK | Slack |
| EMAIL | メール |
| TEAMS | Teams |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 | 備考 |
|-----------|---------|------|------|------|
| 戻る | 戻るボタン | 通知一覧画面へ遷移（ブラウザバック対応） | read | history.back() 使用 |
| 既読にする | 既読にするボタン | POST /api/v1/notifications/{id}/actions/read | read (本人のみ) | 未読時のみ表示、成功後バッジ更新 |

### 既読操作の前提条件

| ID | 条件 | UI上の制御 |
|----|------|-----------|
| INV-NTF-001 | 既読は本人のみ | 本人以外はボタン非表示 |
| INV-NTF-002 | READ後はUNREADに戻せない | 既読後はボタン非表示（またはdisabled） |

### 既読操作後のUI更新

1. 「既読にする」ボタンを非表示（またはdisabled）にする
2. ReadStatusBadge を「未読」(青) → 「既読」(灰) に更新
3. readAt に現在日時を表示
4. Toast 通知で「既読にしました」を表示

---

## 状態管理

```typescript
/** 通知種別 */
type NotificationType =
  | 'ARTICLE36_ALERT'
  | 'UNAPPLIED_OVERTIME_ALERT'
  | 'APPROVAL_REMINDER'
  | 'APPROVAL_URGENCY'
  | 'CLOCK_FORGOT'
  | 'SHIFT_CHANGE'
  | 'SPECIAL_LEAVE_GRANT'
  | 'LEAVE_EXPIRY_WARNING'
  | 'LEAVE_OBLIGATION_ALERT';

/** 重要度 */
type Importance = 'HIGH' | 'MEDIUM' | 'LOW';

/** 既読状態 */
type ReadStatus = 'UNREAD' | 'READ';

/** 発信元コンテキスト */
type SourceContext =
  | 'ATTENDANCE'
  | 'APPROVAL'
  | 'LEAVE'
  | 'MONTHLY';

/** 外部配信チャネル */
type DeliveryChannel =
  | 'NONE'
  | 'SLACK'
  | 'EMAIL'
  | 'TEAMS';

/** 通知詳細データ */
interface NotificationDetail {
  notificationId: string;
  type: NotificationType;
  importance: Importance;
  title: string;
  body: string;
  sourceContext: SourceContext;
  readStatus: ReadStatus;
  readAt: string | null;           // ISO 8601 datetime
  externalChannel: DeliveryChannel;
  externalDelivered: boolean;
  sentAt: string;                  // ISO 8601 datetime
}

/** 既読操作の状態 */
interface MarkAsReadState {
  isSubmitting: boolean;
  error: {
    message: string;
    retryAction: (() => void) | null;
  } | null;
}

/** 画面全体の状態 */
interface NotificationDetailState {
  /** 通知データ */
  data: {
    notification: NotificationDetail | null;
    isLoading: boolean;
    error: {
      message: string;
      retryAction: (() => void) | null;
    } | null;
  };

  /** 既読操作 */
  markAsRead: MarkAsReadState;
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------|
| 詳細取得 | `/api/v1/notifications/{id}` | GET | id (パスパラメータ) |
| 既読にする | `/api/v1/notifications/{id}/actions/read` | POST | id (パスパラメータ)、ボディ空 |

### リクエスト例（詳細取得）

```
GET /api/v1/notifications/NTF-20260210-001
```

### レスポンス例（詳細取得）

```json
{
  "notificationId": "NTF-20260210-001",
  "type": "ARTICLE36_ALERT",
  "importance": "HIGH",
  "title": "36協定の上限に近づいています",
  "body": "今月の残業時間が36協定の上限の80%に達しました。\n残りの稼働可能時間を確認し、業務調整を行ってください。\n詳細は勤怠管理画面をご確認ください。",
  "sourceContext": "ATTENDANCE",
  "readStatus": "UNREAD",
  "readAt": null,
  "externalChannel": "SLACK",
  "externalDelivered": true,
  "sentAt": "2026-02-10T09:30:00+09:00"
}
```

### リクエスト例（既読操作）

```
POST /api/v1/notifications/NTF-20260210-001/actions/read
Content-Type: application/json

{}
```

### レスポンス例（既読操作）

```json
{
  "notificationId": "NTF-20260210-001",
  "readStatus": "READ",
  "readAt": "2026-02-10T10:15:00+09:00"
}
```

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | リダイレクト | ログイン画面へ |
| 権限エラー | 403 | Toast (error) | 「この通知を閲覧する権限がありません」 |
| 通知が見つからない | 404 | 画面内メッセージ | 「通知が見つかりません」+ 一覧に戻るボタン |
| 既読操作: 既に既読 | 409 | Toast (warning) | 「この通知は既に既読です」→ バッジ表示を既読に更新 |
| 既読操作: 前提条件不一致 | 422 | Toast (error) | エラーメッセージを表示 |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | フル表示（メタ情報は横2列配置） |
| Tablet (768-1024px) | メタ情報は横2列維持、余白縮小 |
| Mobile (<768px) | メタ情報は縦1列に切り替え、本文領域フル幅 |

### Mobile レイアウト

```
┌──────────────────────────────────┐
│ ← 通知詳細                      │
├──────────────────────────────────┤
│ [■高■]  [●未読]                  │
│                                  │
│ 種別     36協定アラート          │
│ 発信元   勤怠管理                │
│ 送信日時 2026/02/10 09:30        │
├──────────────────────────────────┤
│ 36協定の上限に近づいています     │
│                                  │
│ 今月の残業時間が36協定の上限の   │
│ 80%に達しました。残りの稼働可能  │
│ 時間を確認し...                  │
├──────────────────────────────────┤
│ 外部配信  Slack  ✔               │
├──────────────────────────────────┤
│ [■ 既読にする ■]                 │
└──────────────────────────────────┘
```

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ページ背景 |
| サーフェスカラー | #F9FAFB (gray-50) | メタ情報・外部配信セクション背景 |
| テキスト: Primary | #111827 (gray-900) | タイトル・本文 |
| テキスト: Secondary | #6B7280 (gray-500) | ラベル・補足情報 |
| ボーダー | #E5E7EB (gray-200) | セクション区切り |
| アクセントカラー | #2563EB (blue-600) | Primaryボタン・リンク |
| バッジ: 重要度 HIGH | red-100 / red-700 | 赤バッジ「高」 |
| バッジ: 重要度 MEDIUM | yellow-100 / yellow-700 | 黄バッジ「中」 |
| バッジ: 重要度 LOW | gray-100 / gray-700 | 灰バッジ「低」 |
| バッジ: 未読 | blue-100 / blue-700 | 青バッジ「未読」 |
| バッジ: 既読 | gray-100 / gray-700 | 灰バッジ「既読」 |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| ページタイトル | system-ui | 24px | 700 | パンくず下 |
| セクション見出し | system-ui | 16px | 600 | メタ情報・本文・外部配信 |
| 通知タイトル | system-ui | 20px | 600 | 本文セクション内見出し |
| 通知本文 | system-ui | 14px | 400 | 改行保持 |
| メタラベル | system-ui | 12px | 500 | 「重要度」「発信元」等 |
| メタ値 | system-ui | 14px | 400 | ラベルに対応する値 |
| 日時表示 | monospace | 14px | 400 | YYYY/MM/DD HH:mm |
| バッジテキスト | system-ui | 12px | 500 | 高/中/低、未読/既読 |
| ボタンラベル | system-ui | 14px | 500 | 既読にする・戻る |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| ページ左右パディング | 24px |
| セクション: パディング | 16px |
| セクション: 角丸 | 8px |
| セクション間余白 | 16px |
| メタ情報: 2列グリッド | grid-template-columns: 1fr 1fr |
| メタ情報: 行間 | 12px |
| 本文セクション: 行間 | 1.6 (line-height) |
| ボタン角丸 | 6px |
| ボタン高さ | 36px |
| バッジ角丸 | 12px (pill) |
| バッジパディング | 2px 10px |
| カード影 | なし（clean-minimal） |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------|
| 「既読にする」ボタン: デフォルト | 背景 blue-600 + テキスト白 |
| 「既読にする」ボタン: ホバー | 背景色 5% 暗く (blue-700) |
| 「既読にする」ボタン: 処理中 | spinner + 「処理中...」+ disabled |
| 「既読にする」ボタン: 非表示条件 | readStatus === 'READ' の場合 |
| 「戻る」ボタン: デフォルト | 背景 transparent + ボーダー gray-300 + テキスト gray-700 |
| 「戻る」ボタン: ホバー | 背景色 gray-50 |
| フォーカス | 2px outline (blue-600) + 2px offset |
| ローディング | 全セクションに Skeleton UI |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| パンくずリンク: ホバー | テキスト色 blue-600 + underline |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- メタ情報セクションの過度な装飾（罫線+背景色で十分）
- 本文のリッチテキストエディタ表示（読み取り専用のため不要）

---

## 品質チェック結果

- [x] 全クエリカラムに対応する表示要素がある（10フィールド全てメタ情報・本文・外部配信セクションに配置）
- [x] 全コマンドに対応する操作UIがある（「既読にする」ボタン → POST /notifications/{id}/actions/read）
- [x] 前提条件がUI上で制御されている（UNREAD時のみボタン表示、本人のみ操作可能）
- [x] 不変条件がUI上で反映されている（INV-NTF-001: 本人のみ既読化、INV-NTF-002: 既読後は戻せない→ボタン非表示）
- [x] エラー状態の表示が定義されている（Toast通知 + 再試行ボタン、404対応、409対応）
- [x] 状態遷移がUI上で表現されている（既読操作後のバッジ変化・ボタン非表示化・readAt表示）
- [x] レスポンシブ対応が定義されている（Desktop/Tablet/Mobile の3段階）
- [x] デザインガイドライン全5セクションが含まれている

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 詳細
コンポーネント数: 14
DataTable: 0
SearchForm: 0
フォーム数: 0
チャート数: 0
-->
