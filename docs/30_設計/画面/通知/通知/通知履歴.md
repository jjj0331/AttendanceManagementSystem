# 通知履歴

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-NTF-002 |
| 画面種別 | 一覧 |
| 関連集約 | 通知（通知コンテキスト） |
| URL | `/notifications` |

---

## ワイヤーフレーム

```
┌───────────────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                          [user ▼]   │
├───────────────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 通知 > 通知履歴                                                │
├───────────────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────────────┐ │
│ │ 検索条件                                                                     │ │
│ │                                                                             │ │
│ │ 重要度     [全件          ▼]   種別       [全件              ▼]              │ │
│ │ 既読       [全件          ▼]   期間       [2026/01/10] ～ [2026/02/09]      │ │
│ │                                                                             │ │
│ │                                                    [クリア]  [■ 検索 ■]     │ │
│ └───────────────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────────────┤
│ 件数: 45件                                                                       │
├───────────────────────────────────────────────────────────────────────────────────┤
│ ┌────┬──────────────────────┬──────────────┬──────┬───────────┬──────┬────────┐  │
│ │重要│ タイトル             │ 種別         │発信元│ 送信日時 ▼│ 既読 │外部配信│  │
│ │度 ▼│                      │              │      │           │      │        │  │
│ ├────┼──────────────────────┼──────────────┼──────┼───────────┼──────┼────────┤  │
│ │ 高 │ 36協定超過の恐れ...  │ 36協定アラート│ 勤怠 │ 02/09 10: │[未読]│ Slack  │  │
│ │ 中 │ 残業申請が未承認...  │ 承認リマインダー│ 承認 │ 02/08 09: │[既読]│  なし  │  │
│ │ 低 │ シフトが変更され...  │ シフト変更   │ 勤怠 │ 02/07 18: │[既読]│  なし  │  │
│ │ 高 │ 有給取得義務の未...  │ 有給取得義務 │ 休暇 │ 02/06 09: │[未読]│ メール │  │
│ └────┴──────────────────────┴──────────────┴──────┴───────────┴──────┴────────┘  │
├───────────────────────────────────────────────────────────────────────────────────┤
│ < 1 2 3 >                                                    20件/ページ ▼     │
└───────────────────────────────────────────────────────────────────────────────────┘
```

---

## コンポーネント構成

```
NotificationHistoryPage
├── Breadcrumb
│   └── BreadcrumbItem ("ホーム", "通知", "通知履歴")
├── SearchForm (上部固定)
│   ├── ImportanceSelect (重要度)
│   ├── NotificationTypeSelect (種別)
│   ├── ReadStatusSelect (既読)
│   ├── DateRangePicker (期間)
│   └── ButtonGroup
│       ├── ClearButton (クリア)
│       └── SearchButton (検索)
├── ActionBar
│   └── ResultCount (検索結果件数)
├── DataTable
│   ├── TableHeader (ソート可: 重要度, 送信日時)
│   ├── TableRow (クリックで通知詳細画面へ遷移)
│   │   ├── ImportanceBadge (重要度バッジ)
│   │   ├── TitleCell (タイトル ※省略表示)
│   │   ├── TypeCell (種別: NotificationType表示名)
│   │   ├── SourceContextCell (発信元: SourceContext表示名)
│   │   ├── SentAtCell (送信日時)
│   │   ├── ReadStatusBadge (既読/未読バッジ)
│   │   └── ExternalChannelCell (外部配信チャンネル)
│   └── EmptyState ("該当する通知がありません")
└── Pagination
    ├── PageNumbers
    └── PageSizeSelector (20件/ページ)
```

---

## 表示項目

### 一覧カラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|------|------|
| importance | 重要度 | badge | ✅ | 60px | 高/中/低 バッジ |
| title | タイトル | text | - | auto | 省略表示（40文字+...） |
| type | 種別 | text | - | 140px | NotificationType表示名 |
| sourceContext | 発信元 | text | - | 80px | SourceContext表示名 |
| sentAt | 送信日時 | datetime | ✅ (デフォルト降順) | 110px | MM/DD HH: 形式 |
| readStatus | 既読 | badge | - | 70px | 既読/未読バッジ |
| externalChannel | 外部配信 | text | - | 90px | チャンネル名 or なし |

### 重要度バッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| HIGH | 高 | red-700 | red-100 |
| MEDIUM | 中 | yellow-700 | yellow-100 |
| LOW | 低 | gray-700 | gray-100 |

### 既読ステータスバッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| UNREAD | 未読 | blue-700 | blue-100 |
| READ | 既読 | gray-500 | gray-100 |

### 未読行の視覚的強調

| 状態 | スタイル |
|------|---------|
| 未読行 | 背景色 blue-50、タイトル font-weight: 600 |
| 既読行 | 背景色なし（通常表示） |

### NotificationType 表示名マッピング

| Enum値 | 表示名 |
|--------|--------|
| ARTICLE36_ALERT | 36協定アラート |
| UNAPPLIED_OVERTIME_ALERT | 未申請残業 |
| APPROVAL_REMINDER | 承認リマインダー |
| APPROVAL_URGENCY | 承認緊急 |
| CLOCK_FORGOT | 打刻忘れ |
| SHIFT_CHANGE | シフト変更 |
| SPECIAL_LEAVE_GRANT | 特別休暇付与 |
| LEAVE_EXPIRY_WARNING | 有給期限警告 |
| LEAVE_OBLIGATION_ALERT | 有給取得義務 |

### SourceContext 表示名マッピング

| Enum値 | 表示名 |
|--------|--------|
| ATTENDANCE | 勤怠 |
| APPROVAL | 承認 |
| LEAVE | 休暇 |
| MONTHLY | 月次 |

### DeliveryChannel 表示名マッピング

| Enum値 | 表示名 |
|--------|--------|
| NONE | なし |
| SLACK | Slack |
| EMAIL | メール |
| TEAMS | Teams |

---

## 検索条件

| 条件 | フィールド名 | 入力形式 | 演算子 | デフォルト | 備考 |
|------|-------------|---------|--------|-----------|------|
| 重要度 | importance | セレクト (Importance) | = | 全件 | HIGH/MEDIUM/LOW+全件 |
| 種別 | type | セレクト (NotificationType) | = | 全件 | 9種+全件 |
| 既読 | readStatus | セレクト (ReadStatus) | = | 全件 | UNREAD/READ+全件 |
| 期間 | period | 日付範囲 (DateRange) | BETWEEN | 直近30日 | カレンダーピッカー |

### 暗黙フィルタ

| フィールド | 値 | 備考 |
|-----------|-----|------|
| recipientId | ログインユーザーID | URLパラメータには含めない。API側で自動付与 |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 検索 | 検索ボタン | 検索条件で一覧再取得 | read (本人) |
| クリア | クリアボタン | 検索条件をデフォルトに戻す | read |
| ソート変更 | カラムヘッダークリック | ソート条件変更 + 一覧再取得 | read |
| ページ切替 | ページネーション操作 | ページ変更 + 一覧再取得 | read |

### 行アクション

| アクション | 処理 | 備考 |
|-----------|------|------|
| 行クリック | 通知詳細画面 (SCR-NTF-003) へ遷移 | 閲覧専用、全行共通 |

---

## 状態管理

```typescript
/** 重要度 */
type Importance = 'HIGH' | 'MEDIUM' | 'LOW';

/** 通知種別 */
type NotificationType =
  | 'ARTICLE36_ALERT'
  | 'UNAPPLIED_OVERTIME_ALERT'
  | 'APPROVAL_REMINDER'
  | 'APPROVAL_URGENCY'
  | 'CLOCK_FORGOT'
  | 'SHIFT_CHANGE'
  | 'SPECIAL_LEAVE_GRANT'
  | 'LEAVE_EXPIRY_WARNING'
  | 'LEAVE_OBLIGATION_ALERT';

/** 既読ステータス */
type ReadStatus = 'UNREAD' | 'READ';

/** 発信元コンテキスト */
type SourceContext = 'ATTENDANCE' | 'APPROVAL' | 'LEAVE' | 'MONTHLY';

/** 外部配信チャンネル */
type DeliveryChannel = 'NONE' | 'SLACK' | 'EMAIL' | 'TEAMS';

/** ソート方向 */
type SortOrder = 'asc' | 'desc';

/** ソート可能カラム */
type SortableColumn = 'importance' | 'sentAt';

/** 通知履歴一覧アイテム */
interface NotificationItem {
  notificationId: string;
  importance: Importance;
  title: string;
  type: NotificationType;
  sourceContext: SourceContext;
  sentAt: string;                    // ISO 8601 datetime
  readStatus: ReadStatus;
  externalChannel: DeliveryChannel;
}

/** 検索パラメータ */
interface SearchParams {
  importance: Importance | null;     // null = 全件
  type: NotificationType | null;     // null = 全件
  readStatus: ReadStatus | null;     // null = 全件
  dateFrom: string;                  // ISO 8601 date、デフォルト: 30日前
  dateTo: string;                    // ISO 8601 date、デフォルト: 本日
}

/** ページネーション */
interface PaginationState {
  offset: number;                    // 現在オフセット (0-based)
  size: number;                      // 1ページあたり件数 (デフォルト: 20)
  sort: SortableColumn;              // ソートカラム (デフォルト: sentAt)
  order: SortOrder;                  // ソート方向 (デフォルト: desc)
}

/** 画面全体の状態 */
interface NotificationHistoryState {
  /** 検索条件 */
  searchParams: SearchParams;

  /** ページネーション */
  pagination: PaginationState;

  /** データ */
  data: {
    content: NotificationItem[];
    page: {
      offset: number;
      size: number;
      totalElements: number;
      totalPages: number;
    };
    isLoading: boolean;
    error: {
      message: string;
      retryAction: (() => void) | null;
    } | null;
  };
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------|
| 一覧取得 | `/api/v1/notifications` | GET | importance, type, readStatus, dateFrom, dateTo, offset, size, sort |

### リクエスト例

```
GET /api/v1/notifications
  ?importance=
  &type=
  &readStatus=
  &dateFrom=2026-01-10
  &dateTo=2026-02-09
  &offset=0
  &size=20
  &sort=sentAt,desc
```

### レスポンス例

```json
{
  "content": [
    {
      "notificationId": "NTF-20260209-001",
      "importance": "HIGH",
      "title": "36協定超過の恐れがあります",
      "type": "ARTICLE36_ALERT",
      "sourceContext": "ATTENDANCE",
      "sentAt": "2026-02-09T10:00:00+09:00",
      "readStatus": "UNREAD",
      "externalChannel": "SLACK"
    }
  ],
  "page": {
    "offset": 0,
    "size": 20,
    "totalElements": 45,
    "totalPages": 3
  }
}
```

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | リダイレクト | ログイン画面へ |
| 権限エラー | 403 | Toast (error) | 「通知の閲覧権限がありません」 |
| バリデーションエラー | 400 | Toast (warning) | 検索条件の修正を促す |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | フル表示（全7カラム） |
| Tablet (768-1024px) | 外部配信・発信元カラム非表示（5カラム） |
| Mobile (<768px) | カード形式に切り替え（重要度+タイトル+種別+送信日時+既読） |

### Mobile カード形式

```
┌──────────────────────────────────┐
│ [高]  36協定アラート     [未読] │
│ 36協定超過の恐れがあります...   │
│ 02/09 10:00               勤怠  │
├──────────────────────────────────┤
│ [中]  承認リマインダー   [既読] │
│ 残業申請が未承認です...         │
│ 02/08 09:00               承認  │
└──────────────────────────────────┘
```

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ページ背景 |
| サーフェスカラー | #F9FAFB (gray-50) | 検索フォーム背景 |
| テキスト: Primary | #111827 (gray-900) | 見出し・データ値 |
| テキスト: Secondary | #6B7280 (gray-500) | ラベル・補足 |
| ボーダー | #E5E7EB (gray-200) | テーブル罫線・区切り |
| アクセントカラー | #2563EB (blue-600) | Primary ボタン・ソートアイコン |
| 未読行: 背景 | #EFF6FF (blue-50) | 未読通知の行背景 |
| バッジ: 重要度 高 | red-100 / red-700 | HIGH |
| バッジ: 重要度 中 | yellow-100 / yellow-700 | MEDIUM |
| バッジ: 重要度 低 | gray-100 / gray-700 | LOW |
| バッジ: 未読 | blue-100 / blue-700 | UNREAD |
| バッジ: 既読 | gray-100 / gray-500 | READ |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| ページタイトル | system-ui | 24px | 700 | パンくず下 |
| 検索ラベル | system-ui | 12px | 500 | 検索条件ラベル |
| テーブルヘッダー | system-ui | 12px | 600 | カラム名 |
| テーブルデータ | system-ui | 14px | 400 | セルデータ |
| テーブルデータ: 未読行 | system-ui | 14px | 600 | タイトル列のみ太字 |
| 日時表示 | monospace | 14px | 400 | HH:mm 形式を等幅で |
| バッジテキスト | system-ui | 12px | 500 | 重要度・既読状態 |
| 件数表示 | system-ui | 14px | 400 | 「45件」 |
| ボタンラベル | system-ui | 14px | 500 | 検索・クリア |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| ページ左右パディング | 24px |
| 検索フォーム: パディング | 16px |
| 検索フォーム: 角丸 | 8px |
| セクション間余白 | 16px |
| テーブル行高 | 48px |
| ボタン角丸 | 6px |
| ボタン高さ | 36px |
| バッジ角丸 | 12px (pill) |
| バッジパディング | 2px 10px |
| カード影 | なし（clean-minimal） |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------|
| テーブル行: ホバー | 背景色 gray-50 + カーソル pointer |
| テーブル行（未読）: ホバー | 背景色 blue-100 + カーソル pointer |
| ソートヘッダー: ホバー | テキスト色 blue-600 + カーソル pointer |
| ソートヘッダー: アクティブ | ▲/▼ アイコン表示 + テキスト色 blue-600 |
| ボタン: ホバー | 背景色 5% 暗く |
| ボタン: disabled | opacity: 0.4 |
| フォーカス | 2px outline (blue-600) + 2px offset |
| ローディング | テーブル部分に Skeleton UI（5行分） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| ページネーション: ホバー | 背景色 gray-100 |
| ページネーション: 現在ページ | 背景色 blue-600 + テキスト白 |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- テーブルのゼブラストライプ（clean-minimalでは罫線のみ）
- 検索条件の過度な装飾（シンプルなフォームで十分）
- 未読/既読の過剰な視覚差（背景色+太字の最低限に留める）

---

## 品質チェック結果

- [x] 全クエリに対応する表示要素がある（7カラムのDataTable、4条件の検索フォーム、ページネーション）
- [x] 全コマンドに対応する操作UIがある（閲覧専用のため新規作成・編集不要、行クリック → 詳細画面遷移）
- [x] エラー状態の表示が定義されている（Toast通知 + 再試行ボタン、認証・権限エラー対応）
- [x] 状態遷移がUI上で表現されている（3段階の重要度バッジ、未読/既読バッジ、未読行の背景色強調）

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 一覧
コンポーネント数: 17
DataTable: 1
SearchForm: 1
フォーム数: 1
チャート数: 0
-->
