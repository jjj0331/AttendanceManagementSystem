# 未読通知一覧

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-NTF-001 |
| 画面種別 | 一覧 |
| 関連集約 | 通知（通知コンテキスト） |
| URL | `/notifications/unread` |

---

## ワイヤーフレーム

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 通知 > 未読通知一覧                                   │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────┐ │
│ │ 検索条件                                                             │ │
│ │                                                                     │ │
│ │ 重要度   [全て                  ▼]                                   │ │
│ │ 発信元   [全て                  ▼]                                   │ │
│ │                                                                     │ │
│ │                                          [クリア]  [■ 検索 ■]       │ │
│ └───────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────┤
│ □ 全選択  件数: 8件                               [■ 一括既読 ■]       │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌────┬────────┬────────────────────────────┬──────────┬──────────────┐   │
│ │ □  │ 重要度 │ タイトル                   │ 発信元   │ 送信日時 ▼   │   │
│ ├────┼────────┼────────────────────────────┼──────────┼──────────────┤   │
│ │ □  │ [高]   │ 残業申請が承認されました   │ 承認     │ 02/09 18:30  │   │
│ │ □  │ [中]   │ シフト変更のお知らせ       │ 勤怠     │ 02/09 15:00  │   │
│ │ □  │ [低]   │ 月次レポートが確定しました │ 月次     │ 02/08 09:00  │   │
│ │ □  │ [高]   │ 休暇申請が却下されました   │ 休暇     │ 02/07 17:45  │   │
│ └────┴────────┴────────────────────────────┴──────────┴──────────────┘   │
├───────────────────────────────────────────────────────────────────────────┤
│ < 1 2 3 >                                             20件/ページ ▼   │
└───────────────────────────────────────────────────────────────────────────┘
```

---

## コンポーネント構成

```
UnreadNotificationListPage
├── Breadcrumb
│   └── BreadcrumbItem ("ホーム", "通知", "未読通知一覧")
├── SearchForm (上部固定)
│   ├── ImportanceSelect (重要度)
│   ├── SourceContextSelect (発信元)
│   └── ButtonGroup
│       ├── ClearButton (クリア)
│       └── SearchButton (検索)
├── ActionBar
│   ├── SelectAllCheckbox (全選択)
│   ├── ResultCount (検索結果件数)
│   └── BulkReadButton ("一括既読" ※選択時のみ活性)
├── DataTable
│   ├── TableHeader (ソート可: 重要度, 送信日時)
│   ├── TableRow (クリックで通知詳細画面へ遷移)
│   │   ├── Checkbox (個別選択)
│   │   ├── ImportanceBadge (重要度バッジ)
│   │   ├── TitleCell (通知タイトル)
│   │   ├── SourceContextCell (発信元表示名)
│   │   └── SentAtCell (送信日時)
│   └── EmptyState ("未読の通知はありません")
└── Pagination
    ├── PageNumbers
    └── PageSizeSelector (20件/ページ)
```

---

## 表示項目

### 一覧カラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|------|------|
| checkbox | - | checkbox | - | 40px | 一括選択用 |
| importance | 重要度 | badge | ✅ | 80px | HIGH/MEDIUM/LOWバッジ |
| title | タイトル | text | - | auto | 通知見出し、クリックで詳細遷移 |
| sourceContext | 発信元 | text | - | 100px | コンテキスト表示名 |
| sentAt | 送信日時 | datetime | ✅ (デフォルト降順) | 140px | MM/DD HH:mm 形式 |

### 重要度バッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| HIGH | 高 | red-700 | red-100 |
| MEDIUM | 中 | yellow-700 | yellow-100 |
| LOW | 低 | gray-700 | gray-100 |

### 発信元表示名

| 値 | 表示 |
|----|------|
| ATTENDANCE | 勤怠 |
| APPROVAL | 承認 |
| LEAVE | 休暇 |
| MONTHLY | 月次 |

---

## 検索条件

| 条件 | フィールド名 | 入力形式 | 演算子 | デフォルト | 備考 |
|------|-------------|---------|--------|-----------|------|
| 重要度 | importance | セレクト (Importance) | = | 全て | HIGH/MEDIUM/LOW + 全て |
| 発信元 | sourceContext | セレクト (SourceContext) | = | 全て | ATTENDANCE/APPROVAL/LEAVE/MONTHLY + 全て |

### 暗黙のフィルタ（UI非表示）

| フィルタ | 値 | 説明 |
|---------|-----|------|
| readStatus | UNREAD | 未読のみ表示 |
| recipientId | currentUserId | ログインユーザーの通知のみ |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 検索 | 検索ボタン | 検索条件で一覧再取得 | read (本人) |
| クリア | クリアボタン | 検索条件をデフォルトに戻す | read |
| 一括既読 | 一括既読ボタン | 選択した通知を既読にする（POST /notifications/{id}/actions/read を選択件数分実行） | write (本人) |
| ソート変更 | カラムヘッダークリック | ソート条件変更 + 一覧再取得 | read |
| ページ切替 | ページネーション操作 | ページ変更 + 一覧再取得 | read |

### 行アクション

| アクション | 処理 | 備考 |
|-----------|------|------|
| 行クリック | 通知詳細画面 (SCR-NTF-003) へ遷移 | 遷移時に自動既読化 |

### 一括既読の挙動

| 条件 | 挙動 |
|------|------|
| 未選択時 | 一括既読ボタン disabled (opacity: 0.4) |
| 選択時 | ボタン活性、「{N}件を既読にする」ラベル |
| 実行中 | ボタン disabled + Spinner 表示 |
| 成功時 | Toast "既読にしました"、一覧再取得（既読化した行は一覧から消える） |
| 一部失敗時 | Toast (warning) "一部の通知を既読にできませんでした"、一覧再取得 |

---

## 状態管理

```typescript
/** 重要度 */
type Importance = 'HIGH' | 'MEDIUM' | 'LOW';

/** 発信元コンテキスト */
type SourceContext =
  | 'ATTENDANCE'
  | 'APPROVAL'
  | 'LEAVE'
  | 'MONTHLY';

/** ソート方向 */
type SortOrder = 'asc' | 'desc';

/** ソート可能カラム */
type SortableColumn = 'importance' | 'sentAt';

/** 通知一覧アイテム */
interface NotificationItem {
  notificationId: string;
  importance: Importance;
  title: string;
  sourceContext: SourceContext;
  sentAt: string;                    // ISO 8601 datetime
}

/** 検索パラメータ */
interface SearchParams {
  importance: Importance | null;     // null = 全て
  sourceContext: SourceContext | null; // null = 全て
}

/** ページネーション */
interface PaginationState {
  page: number;                      // 現在ページ (0-based)
  size: number;                      // 1ページあたり件数 (デフォルト: 20)
  sort: SortableColumn;              // ソートカラム (デフォルト: sentAt)
  order: SortOrder;                  // ソート方向 (デフォルト: desc)
}

/** 選択状態 */
interface SelectionState {
  selectedIds: string[];             // 選択された通知ID
  isAllSelected: boolean;            // 全選択チェックボックス状態
}

/** 一括操作状態 */
interface BulkActionState {
  isProcessing: boolean;             // 一括既読処理中
  processedCount: number;            // 処理済み件数
  failedCount: number;               // 失敗件数
}

/** 画面全体の状態 */
interface UnreadNotificationListState {
  /** 検索条件 */
  searchParams: SearchParams;

  /** ページネーション */
  pagination: PaginationState;

  /** 選択状態 */
  selection: SelectionState;

  /** 一括操作 */
  bulkAction: BulkActionState;

  /** データ */
  data: {
    content: NotificationItem[];
    page: {
      number: number;
      size: number;
      totalElements: number;
      totalPages: number;
    };
    isLoading: boolean;
    error: {
      message: string;
      retryAction: (() => void) | null;
    } | null;
  };
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------|
| 未読一覧取得 | `/api/v1/notifications/unread` | GET | importance, sourceContext, page, size, sort |
| 既読化 | `/api/v1/notifications/{id}/actions/read` | POST | - |

### リクエスト例（一覧取得）

```
GET /api/v1/notifications/unread
  ?importance=
  &sourceContext=
  &page=0
  &size=20
  &sort=sentAt,desc
```

### レスポンス例（一覧取得）

```json
{
  "content": [
    {
      "notificationId": "NTF-20260209-001",
      "importance": "HIGH",
      "title": "残業申請が承認されました",
      "sourceContext": "APPROVAL",
      "sentAt": "2026-02-09T18:30:00+09:00"
    }
  ],
  "page": {
    "number": 0,
    "size": 20,
    "totalElements": 8,
    "totalPages": 1
  }
}
```

### リクエスト例（既読化）

```
POST /api/v1/notifications/NTF-20260209-001/actions/read
```

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | リダイレクト | ログイン画面へ |
| 権限エラー | 403 | Toast (error) | 「この通知を閲覧する権限がありません」 |
| 通知が見つからない | 404 | Toast (warning) | 一覧を再取得 |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |
| 一括既読: 一部失敗 | 207 (部分成功) | Toast (warning) | 「{N}件の既読化に失敗しました」+ 一覧再取得 |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | フル表示（全5カラム + チェックボックス） |
| Tablet (768-1024px) | 発信元カラム非表示（4カラム） |
| Mobile (<768px) | カード形式に切り替え（重要度バッジ+タイトル+送信日時） |

### Mobile カード形式

```
┌──────────────────────────────────┐
│ □ [高] 残業申請が承認されました  │
│      承認  02/09 18:30           │
├──────────────────────────────────┤
│ □ [中] シフト変更のお知らせ      │
│      勤怠  02/09 15:00           │
├──────────────────────────────────┤
│ □ [低] 月次レポートが確定しました│
│      月次  02/08 09:00           │
└──────────────────────────────────┘
```

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ページ背景 |
| サーフェスカラー | #F9FAFB (gray-50) | 検索フォーム背景 |
| テキスト: Primary | #111827 (gray-900) | 見出し・データ値 |
| テキスト: Secondary | #6B7280 (gray-500) | ラベル・補足 |
| ボーダー | #E5E7EB (gray-200) | テーブル罫線・区切り |
| アクセントカラー | #2563EB (blue-600) | Primary ボタン・ソートアイコン |
| バッジ: 高 | red-100 / red-700 | HIGH |
| バッジ: 中 | yellow-100 / yellow-700 | MEDIUM |
| バッジ: 低 | gray-100 / gray-700 | LOW |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| ページタイトル | system-ui | 24px | 700 | パンくず下 |
| 検索ラベル | system-ui | 12px | 500 | 検索条件ラベル |
| テーブルヘッダー | system-ui | 12px | 600 | カラム名 |
| テーブルデータ | system-ui | 14px | 400 | セルデータ |
| 日時表示 | monospace | 14px | 400 | MM/DD HH:mm 形式を等幅で |
| バッジテキスト | system-ui | 12px | 500 | 重要度文字列 |
| 件数表示 | system-ui | 14px | 400 | 「8件」 |
| ボタンラベル | system-ui | 14px | 500 | 検索・一括既読 |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| ページ左右パディング | 24px |
| 検索フォーム: パディング | 16px |
| 検索フォーム: 角丸 | 8px |
| セクション間余白 | 16px |
| テーブル行高 | 48px |
| ボタン角丸 | 6px |
| ボタン高さ | 36px |
| バッジ角丸 | 12px (pill) |
| バッジパディング | 2px 10px |
| カード影 | なし（clean-minimal） |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------|
| テーブル行: ホバー | 背景色 gray-50 + カーソル pointer |
| ソートヘッダー: ホバー | テキスト色 blue-600 + カーソル pointer |
| ソートヘッダー: アクティブ | ▲/▼ アイコン表示 + テキスト色 blue-600 |
| チェックボックス: ホバー | border色 blue-600 |
| チェックボックス: チェック済 | 背景色 blue-600 + チェックマーク白 |
| 一括既読ボタン: 未選択時 | disabled (opacity: 0.4) |
| 一括既読ボタン: 選択時 | 活性 + 件数ラベル |
| 一括既読ボタン: 処理中 | disabled + Spinner |
| ボタン: ホバー | 背景色 5% 暗く |
| フォーカス | 2px outline (blue-600) + 2px offset |
| ローディング | テーブル部分に Skeleton UI（5行分） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| ページネーション: ホバー | 背景色 gray-100 |
| ページネーション: 現在ページ | 背景色 blue-600 + テキスト白 |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- テーブルのゼブラストライプ（clean-minimalでは罫線のみ）
- 検索条件の過度な装飾（シンプルなフォームで十分）
- 未読バッジに過度なパルスアニメーション

---

## 品質チェック結果

- [x] 全クエリに対応する表示要素がある（5カラムのDataTable、2条件の検索フォーム+2暗黙フィルタ、ページネーション）
- [x] 全コマンドに対応する操作UIがある（一括既読ボタン、行クリック → 詳細画面遷移、検索・クリア・ソート・ページ切替）
- [x] エラー状態の表示が定義されている（Toast通知 + 再試行ボタン、一括既読の部分失敗対応）
- [x] 状態遷移がUI上で表現されている（3種の重要度バッジで色分け、一括既読ボタンの状態変化、選択状態管理）

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 一覧
コンポーネント数: 17
DataTable: 1
SearchForm: 1
フォーム数: 1
チャート数: 0
-->
