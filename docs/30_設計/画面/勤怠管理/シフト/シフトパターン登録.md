# シフトパターン登録

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-SHF-002 |
| 画面種別 | モーダル |
| 関連集約 | シフト（勤怠管理コンテキスト） |
| URL | - （モーダル。シフトパターン一覧から呼出） |

---

## ワイヤーフレーム

```
         ┌──────────────────────────────────────────┐
         │  シフトパターン登録                 [×]  │
         ├──────────────────────────────────────────┤
         │                                          │
         │  パターン名 *                            │
         │  ┌──────────────────────────────────┐   │
         │  │ (例: 早番)                       │   │
         │  └──────────────────────────────────┘   │
         │                                          │
         │  勤務開始時刻 *        勤務終了時刻 *    │
         │  ┌──────────────┐    ┌──────────────┐   │
         │  │ 09:00        │    │ 18:00        │   │
         │  └──────────────┘    └──────────────┘   │
         │                                          │
         │  休憩時間（分）*                         │
         │  ┌──────────────┐                       │
         │  │ 60           │                       │
         │  └──────────────┘                       │
         │                                          │
         │  □ 日跨ぎ（夜勤）                       │
         │                                          │
         ├──────────────────────────────────────────┤
         │               [キャンセル] [■ 登録 ■]   │
         └──────────────────────────────────────────┘
```

### バリデーションエラー時

```
         ┌──────────────────────────────────────────┐
         │  シフトパターン登録                 [×]  │
         ├──────────────────────────────────────────┤
         │                                          │
         │  パターン名 *                            │
         │  ┌──────────────────────────────────┐   │
         │  │ A                                │   │
         │  └──────────────────────────────────┘   │
         │  ⚠ 2〜20文字で入力してください          │
         │                                          │
         │  ...                                     │
         └──────────────────────────────────────────┘
```

---

## コンポーネント構成

```
ShiftPatternCreateModal
├── ModalHeader
│   ├── Title ("シフトパターン登録")
│   └── CloseButton
├── ModalBody
│   └── PatternForm
│       ├── TextInput (name: パターン名)
│       ├── TimeInputGroup
│       │   ├── TimeInput (startTime: 勤務開始時刻)
│       │   └── TimeInput (endTime: 勤務終了時刻)
│       ├── NumberInput (breakMinutes: 休憩時間)
│       └── Checkbox (isOvernight: 日跨ぎ)
├── ModalFooter
│   ├── CancelButton (キャンセル)
│   └── SubmitButton (登録)
└── ToastNotification (登録結果通知)
```

---

## 表示項目

### フォームフィールド

| フィールド | 表示名 | 型 | 必須 | 制約 | デフォルト | 備考 |
|-----------|--------|-----|------|------|-----------|------|
| name | パターン名 | text | ✅ | 2-20文字、一意 | - | プレースホルダー「例: 早番」 |
| startTime | 勤務開始時刻 | time | ✅ | HH:mm | - | タイムピッカー |
| endTime | 勤務終了時刻 | time | ✅ | HH:mm | - | タイムピッカー |
| breakMinutes | 休憩時間（分） | number | ✅ | 0-120 | 60 | 数値入力 |
| isOvernight | 日跨ぎ（夜勤） | checkbox | ✅ | - | false | 夜勤対応 |

### バリデーションルール

| フィールド | ルール | エラーメッセージ |
|-----------|--------|----------------|
| name | 必須 | パターン名を入力してください |
| name | 2-20文字 | 2〜20文字で入力してください |
| startTime | 必須 | 勤務開始時刻を入力してください |
| endTime | 必須 | 勤務終了時刻を入力してください |
| breakMinutes | 必須 | 休憩時間を入力してください |
| breakMinutes | 0-120 | 0〜120分の範囲で入力してください |

---

## アクション

### モーダルアクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 登録 | 登録ボタン | POST /patterns → 成功時: Toast表示 + モーダル閉 + 一覧再取得 | write (人事のみ) |
| キャンセル | キャンセルボタン or [×] or Escape or オーバーレイクリック | モーダルを閉じる（入力内容破棄） | - |

### 登録後の動作

1. 登録APIを呼び出す
2. 成功: Toast (success)「シフトパターン "{name}" を登録しました」
3. モーダルを閉じる
4. 親画面（シフトパターン一覧）を再取得

---

## 状態管理

```typescript
/** フォーム入力値 */
interface PatternFormValues {
  name: string;
  startTime: string;        // HH:mm
  endTime: string;          // HH:mm
  breakMinutes: number;
  isOvernight: boolean;
}

/** フィールドエラー */
interface FieldErrors {
  name?: string;
  startTime?: string;
  endTime?: string;
  breakMinutes?: string;
}

/** モーダル状態 */
interface ShiftPatternCreateModalState {
  /** モーダル表示状態 */
  isOpen: boolean;

  /** フォーム入力値 */
  formValues: PatternFormValues;

  /** フィールドエラー */
  fieldErrors: FieldErrors;

  /** 送信中フラグ（二重送信防止） */
  isSubmitting: boolean;

  /** サーバーエラー */
  serverError: {
    message: string;
  } | null;
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | リクエスト |
|------|--------------|---------|-----------:|
| パターン登録 | `/api/v1/shifts/patterns` | POST | name, startTime, endTime, breakMinutes, isOvernight |

### リクエスト例

```json
{
  "name": "早番",
  "startTime": "06:00",
  "endTime": "15:00",
  "breakMinutes": 60,
  "isOvernight": false
}
```

### レスポンス例（201 Created）

```json
{
  "patternId": "PAT-001",
  "name": "早番",
  "startTime": "06:00",
  "endTime": "15:00",
  "breakMinutes": 60,
  "isOvernight": false,
  "isActive": true,
  "createdAt": "2024-04-01T10:00:00+09:00"
}
```

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | Toast (error) + モーダル閉じ | ログイン画面へリダイレクト |
| バリデーションエラー | 400 | フィールド下にエラーメッセージ | 該当フィールドにフォーカス |
| 重複エラー | 409 | フィールド下にエラーメッセージ | 「同名のパターンが既に存在します」 |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>768px) | 幅 480px モーダル（中央配置） |
| Mobile (<768px) | フルスクリーンモーダル（下からスライドアップ） |

### Mobile 時のレイアウト

```
┌──────────────────────────────────────────┐
│  シフトパターン登録                 [×]  │
├──────────────────────────────────────────┤
│  パターン名 *                            │
│  ┌──────────────────────────────────┐   │
│  │                                  │   │
│  └──────────────────────────────────┘   │
│                                          │
│  勤務開始時刻 *                          │
│  ┌──────────────────────────────────┐   │
│  │                                  │   │
│  └──────────────────────────────────┘   │
│                                          │
│  勤務終了時刻 *                          │
│  ┌──────────────────────────────────┐   │
│  │                                  │   │
│  └──────────────────────────────────┘   │
│                                          │
│  休憩時間（分）*                         │
│  ┌──────────────────────────────────┐   │
│  │                                  │   │
│  └──────────────────────────────────┘   │
│                                          │
│  □ 日跨ぎ（夜勤）                       │
│                                          │
├──────────────────────────────────────────┤
│               [キャンセル] [■ 登録 ■]   │
└──────────────────────────────────────────┘
```

> Mobile では開始時刻・終了時刻を縦並びに変更。

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | モーダル背景 |
| サーフェスカラー | #F9FAFB (gray-50) | - |
| テキスト: Primary | #111827 (gray-900) | ラベル・入力値 |
| テキスト: Secondary | #6B7280 (gray-500) | プレースホルダー |
| ボーダー | #E5E7EB (gray-200) | 入力フィールド枠線 |
| ボーダー: フォーカス | #2563EB (blue-600) | フォーカス時 |
| ボーダー: エラー | #DC2626 (red-600) | バリデーションエラー時 |
| アクセントカラー | #2563EB (blue-600) | 登録ボタン |
| エラーテキスト | #DC2626 (red-600) | エラーメッセージ |
| オーバーレイ | rgba(0, 0, 0, 0.5) | モーダル背景 |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| モーダルタイトル | system-ui | 18px | 600 | ヘッダー |
| フォームラベル | system-ui | 14px | 500 | 必須マーク付き |
| 入力テキスト | system-ui | 14px | 400 | 入力値 |
| プレースホルダー | system-ui | 14px | 400 | gray-500 |
| エラーメッセージ | system-ui | 12px | 400 | red-600 |
| ボタンラベル | system-ui | 14px | 500 | 全ボタン共通 |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| モーダル幅 | 480px（Desktop） / 100vw（Mobile） |
| モーダル角丸 | 12px（Desktop） / 0（Mobile） |
| 内部パディング | 24px |
| フィールド間余白 | 16px |
| ラベルとフィールドの間 | 6px |
| 時刻入力横並び gap | 16px（Desktop） |
| ボタン間 gap | 12px |
| ボタンサイズ | 高さ 40px |
| ボタン角丸 | 6px |
| 入力フィールド角丸 | 6px |
| 入力フィールド高さ | 40px |
| カード影 | 0 4px 24px rgba(0, 0, 0, 0.15) |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------:|
| フィールド: フォーカス | border-color: blue-600 + ring 2px |
| フィールド: エラー | border-color: red-600 + エラーメッセージ表示 |
| ボタン: ホバー | 背景色 5% 暗く |
| ボタン: disabled | opacity: 0.4, cursor: not-allowed |
| ボタン: 送信中 | スピナー表示、全ボタン disabled |
| モーダル開閉 | フェードイン/アウト 150ms |
| 登録成功 | Toast (success)、3秒自動消去 + モーダル閉じ |
| 登録失敗 | Toast (error) or フィールドエラー表示 |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- フォームフィールドの過度な装飾

---

## 品質チェック結果

- [x] 全フォームフィールドがAPIリクエストと一致している（5フィールド）
- [x] バリデーションルールがAPI制約と一致している（name: 2-20文字、breakMinutes: 0-120）
- [x] エラー状態の表示が定義されている（フィールドエラー + Toast通知、重複エラー対応）
- [x] 二重送信防止が定義されている（isSubmitting フラグ）

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: モーダル
コンポーネント数: 11
DataTable: 0
SearchForm: 0
フォーム数: 1
チャート数: 0
-->
