# シフトパターン一覧

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-SHF-001 |
| 画面種別 | 一覧 |
| 関連集約 | シフト（勤怠管理コンテキスト） |
| URL | `/shifts/patterns` |

---

## ワイヤーフレーム

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 勤怠管理 > シフトパターン一覧                          │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────┐ │
│ │ 検索条件                                                             │ │
│ │                                                                     │ │
│ │ 有効/無効  [全て ▼]                                                  │ │
│ │                                                                     │ │
│ │                                          [クリア]  [■ 検索 ■]       │ │
│ └───────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────┤
│ 件数: 5件                                          [■ + 新規登録 ■]     │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌────────────┬──────────┬──────────┬──────┬──────┬──────┬──────┐        │
│ │ パターン名▼│ 開始時刻 │ 終了時刻 │ 休憩 │ 夜勤 │ 有効 │ 操作 │        │
│ ├────────────┼──────────┼──────────┼──────┼──────┼──────┼──────┤        │
│ │ 早番       │ 06:00    │ 15:00    │ 60分 │  -   │  ✅  │ ...  │        │
│ │ 日勤       │ 09:00    │ 18:00    │ 60分 │  -   │  ✅  │ ...  │        │
│ │ 遅番       │ 14:00    │ 23:00    │ 60分 │  -   │  ✅  │ ...  │        │
│ │ 夜勤       │ 22:00    │ 07:00    │ 60分 │  ✅  │  ✅  │ ...  │        │
│ │ 準夜勤     │ 16:00    │ 01:00    │ 60分 │  ✅  │  ❌  │ ...  │        │
│ └────────────┴──────────┴──────────┴──────┴──────┴──────┴──────┘        │
├───────────────────────────────────────────────────────────────────────────┤
│ < 1 >                                              20件/ページ ▼       │
└───────────────────────────────────────────────────────────────────────────┘
```

### 行アクションメニュー（...クリック時）

```
┌──────────────┐
│ 無効化       │  ← isActive=true の場合
│ 再有効化     │  ← isActive=false の場合
└──────────────┘
```

### 「+ 新規登録」ボタン押下時

```
                       ┌──────────────────────────┐
 [■ + 新規登録 ■] ───→ │ シフトパターン登録モーダル │
                       │ （SCR-SHF-002）           │
                       └──────────────────────────┘
```

---

## コンポーネント構成

```
ShiftPatternListPage
├── Breadcrumb
│   └── BreadcrumbItem ("ホーム", "勤怠管理", "シフトパターン一覧")
├── SearchForm (上部固定)
│   ├── ActiveSelect (有効/無効/全て)
│   └── ButtonGroup
│       ├── ClearButton (クリア)
│       └── SearchButton (検索)
├── ActionBar
│   ├── ResultCount (検索結果件数)
│   └── CreateButton ("+ 新規登録" → モーダル起動)
├── DataTable
│   ├── TableHeader (ソート可: パターン名)
│   ├── TableRow
│   │   ├── PatternNameCell (パターン名)
│   │   ├── TimeCell (開始時刻)
│   │   ├── TimeCell (終了時刻)
│   │   ├── BreakCell (休憩時間)
│   │   ├── OvernightBadge (夜勤フラグ)
│   │   ├── ActiveBadge (有効/無効バッジ)
│   │   └── ActionMenu (無効化/再有効化)
│   └── EmptyState ("シフトパターンが登録されていません")
├── Pagination
│   ├── PageNumbers
│   └── PageSizeSelector (20件/ページ)
├── ShiftPatternCreateModal (SCR-SHF-002、条件付き表示)
└── ConfirmDialog (無効化/再有効化確認)
```

---

## 表示項目

### 一覧カラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|------|------|
| name | パターン名 | text | ✅ (デフォルト昇順) | 150px | - |
| startTime | 開始時刻 | time | - | 100px | HH:mm 形式 |
| endTime | 終了時刻 | time | - | 100px | HH:mm 形式 |
| breakMinutes | 休憩 | number | - | 80px | N分 形式 |
| isOvernight | 夜勤 | badge | - | 60px | ✅ or - |
| isActive | 有効 | badge | - | 60px | 色分けバッジ |
| actions | 操作 | menu | - | 60px | アクションメニュー |

### 有効/無効バッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| true | 有効 | green-700 | green-100 |
| false | 無効 | gray-700 | gray-100 |

### 夜勤バッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| true | 夜勤 | indigo-700 | indigo-100 |
| false | - | - | - |

---

## 検索条件

| 条件 | フィールド名 | 入力形式 | 演算子 | デフォルト | 備考 |
|------|-------------|---------|--------|-----------|------|
| 有効/無効 | isActive | セレクト (boolean) | = | 全て | true/false/全て |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 検索 | 検索ボタン | 検索条件で一覧再取得 | read (人事+管理職) |
| クリア | クリアボタン | 検索条件をデフォルトに戻す | read |
| 新規登録 | + 新規登録ボタン | シフトパターン登録モーダル (SCR-SHF-002) を開く | write (人事のみ) |
| ソート変更 | カラムヘッダークリック | ソート条件変更 + 一覧再取得 | read |
| ページ切替 | ページネーション操作 | ページ変更 + 一覧再取得 | read |

### 行アクション

| アクション | 処理 | 確認 | 権限 | 条件 |
|-----------|------|------|------|------|
| 無効化 | POST /patterns/{id}/actions/deactivate | 確認ダイアログ | write (人事のみ) | isActive=true |
| 再有効化 | POST /patterns/{id}/actions/reactivate | 確認ダイアログ | write (人事のみ) | isActive=false |

### 確認ダイアログ

| アクション | メッセージ | 確定ボタン | キャンセルボタン |
|-----------|-----------|-----------|----------------|
| 無効化 | 「{パターン名}を無効化しますか？未来の割当で使用されている場合は無効化できません。」 | 無効化する | キャンセル |
| 再有効化 | 「{パターン名}を再有効化しますか？」 | 再有効化する | キャンセル |

---

## 状態管理

```typescript
/** パターン一覧アイテム */
interface ShiftPatternItem {
  patternId: string;
  name: string;
  startTime: string;       // HH:mm
  endTime: string;         // HH:mm
  breakMinutes: number;
  isOvernight: boolean;
  isActive: boolean;
}

/** 検索パラメータ */
interface SearchParams {
  isActive: boolean | null; // null = 全て
}

/** ページネーション */
interface PaginationState {
  page: number;             // 現在ページ (0-based)
  size: number;             // 1ページあたり件数 (デフォルト: 20)
  sort: string;             // ソートカラム (デフォルト: name)
  order: 'asc' | 'desc';   // ソート方向 (デフォルト: asc)
}

/** 画面全体の状態 */
interface ShiftPatternListState {
  /** 検索条件 */
  searchParams: SearchParams;

  /** ページネーション */
  pagination: PaginationState;

  /** データ */
  data: {
    content: ShiftPatternItem[];
    page: {
      number: number;
      size: number;
      totalElements: number;
      totalPages: number;
    };
    isLoading: boolean;
    error: {
      message: string;
      retryAction: (() => void) | null;
    } | null;
  };

  /** 登録モーダル表示状態 */
  createModal: {
    isOpen: boolean;
  };

  /** 確認ダイアログ */
  confirmDialog: {
    isOpen: boolean;
    action: 'deactivate' | 'reactivate' | null;
    targetPattern: ShiftPatternItem | null;
    isSubmitting: boolean;
  };
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------:|
| 一覧取得 | `/api/v1/shifts/patterns` | GET | isActive, page, size, sort |
| 無効化 | `/api/v1/shifts/patterns/{patternId}/actions/deactivate` | POST | - |
| 再有効化 | `/api/v1/shifts/patterns/{patternId}/actions/reactivate` | POST | - |

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | リダイレクト | ログイン画面へ |
| 権限エラー | 403 | Toast (error) | 「この操作を行う権限がありません」 |
| 競合エラー | 409 | Toast (warning) | 「既に無効化/有効化されています」+ 一覧再取得 |
| 事前条件エラー | 422 | Toast (warning) | 「未来の割当で使用中のため無効化できません」 |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | フル表示（全7カラム） |
| Tablet (768-1024px) | 休憩・夜勤カラム非表示（5カラム） |
| Mobile (<768px) | カード形式に切り替え（パターン名+時間帯+有効バッジ） |

### Mobile カード形式

```
┌──────────────────────────────────┐
│ 早番                       [有効] │
│ 06:00 - 15:00  休憩60分          │
│                          [ ... ] │
├──────────────────────────────────┤
│ 夜勤                   [夜勤][有効] │
│ 22:00 - 07:00  休憩60分          │
│                          [ ... ] │
└──────────────────────────────────┘
```

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ページ背景 |
| サーフェスカラー | #F9FAFB (gray-50) | 検索フォーム背景 |
| テキスト: Primary | #111827 (gray-900) | 見出し・データ値 |
| テキスト: Secondary | #6B7280 (gray-500) | ラベル・補足 |
| ボーダー | #E5E7EB (gray-200) | テーブル罫線・区切り |
| アクセントカラー | #2563EB (blue-600) | Primary ボタン・ソートアイコン |
| バッジ: 有効 | green-100 / green-700 | isActive=true |
| バッジ: 無効 | gray-100 / gray-700 | isActive=false |
| バッジ: 夜勤 | indigo-100 / indigo-700 | isOvernight=true |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| ページタイトル | system-ui | 24px | 700 | パンくず下 |
| 検索ラベル | system-ui | 12px | 500 | 検索条件ラベル |
| テーブルヘッダー | system-ui | 12px | 600 | カラム名 |
| テーブルデータ | system-ui | 14px | 400 | セルデータ |
| 時刻表示 | monospace | 14px | 400 | HH:mm 形式を等幅で |
| バッジテキスト | system-ui | 12px | 500 | ステータス文字列 |
| 件数表示 | system-ui | 14px | 400 | 「5件」 |
| ボタンラベル | system-ui | 14px | 500 | 検索・新規登録 |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| ページ左右パディング | 24px |
| 検索フォーム: パディング | 16px |
| 検索フォーム: 角丸 | 8px |
| セクション間余白 | 16px |
| テーブル行高 | 48px |
| ボタン角丸 | 6px |
| ボタン高さ | 36px |
| バッジ角丸 | 12px (pill) |
| バッジパディング | 2px 10px |
| カード影 | なし（clean-minimal） |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------:|
| テーブル行: ホバー | 背景色 gray-50 |
| ソートヘッダー: ホバー | テキスト色 blue-600 + カーソル pointer |
| ソートヘッダー: アクティブ | ▲/▼ アイコン表示 + テキスト色 blue-600 |
| ボタン: ホバー | 背景色 5% 暗く |
| ボタン: disabled | opacity: 0.4 |
| フォーカス | 2px outline (blue-600) + 2px offset |
| ローディング | テーブル部分に Skeleton UI（5行分） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| アクションメニュー | クリック時ドロップダウン表示、外部クリックで閉じる |
| 確認ダイアログ | 中央モーダル、オーバーレイ付き |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- テーブルのゼブラストライプ（clean-minimalでは罫線のみ）
- 検索条件の過度な装飾（シンプルなフォームで十分）

---

## 品質チェック結果

- [x] 全クエリに対応する表示要素がある（7カラムのDataTable、1条件の検索フォーム、ページネーション）
- [x] 全コマンドに対応する操作UIがある（新規登録ボタン→モーダル、無効化/再有効化→アクションメニュー）
- [x] エラー状態の表示が定義されている（Toast通知 + 確認ダイアログ、権限/競合/事前条件エラー対応）
- [x] 状態遷移がUI上で表現されている（有効/無効バッジ、条件付きアクションメニュー）

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 一覧
コンポーネント数: 15
DataTable: 1
SearchForm: 1
フォーム数: 0
チャート数: 0
-->
