# 日次勤怠一覧

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-ATT-002 |
| 画面種別 | 一覧 |
| 関連集約 | 勤怠記録（勤怠管理コンテキスト） |
| URL | `/attendances/daily` |

---

## ワイヤーフレーム

```
┌───────────────────────────────────────────────────────────────────────────┐
│ {システム名}                                                  [user ▼]   │
├───────────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 勤怠管理 > 日次勤怠一覧                               │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────────┐ │
│ │ 検索条件                                                             │ │
│ │                                                                     │ │
│ │ 社員       [ログインユーザー      ▼]                                 │ │
│ │ 勤務期間   [2025/01/01] ～ [2025/01/31]                             │ │
│ │ ステータス [全て                  ▼]                                 │ │
│ │                                                                     │ │
│ │                                          [クリア]  [■ 検索 ■]       │ │
│ └───────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────────────────────────────────────────┤
│ 件数: 31件                                             [■ 打刻する ■]   │
├───────────────────────────────────────────────────────────────────────────┤
│ ┌──────────┬──────┬──────┬──────┬──────────┬──────┬──────────┐          │
│ │ 勤務日 ▼ │ 出勤 │ 退勤 │ 休憩 │ 実労働   │ 残業 │ステータス│          │
│ ├──────────┼──────┼──────┼──────┼──────────┼──────┼──────────┤          │
│ │ 01/15(水)│ 09:02│ 18:03│ 1:00 │ 7:58     │ 0:00 │[確定済]  │          │
│ │ 01/14(火)│ 08:55│ 19:30│ 1:00 │ 9:35     │ 1:35 │[確定済]  │          │
│ │ 01/13(月)│ 09:10│ 18:00│ 1:00 │ 7:50     │ 0:00 │[退勤済]  │          │
│ │ 01/12(日)│ --:--│ --:--│ --:--│ --:--    │ --:--│[未出勤]  │          │
│ │ 01/11(土)│ --:--│ --:--│ --:--│ --:--    │ --:--│[未出勤]  │          │
│ │ 01/10(金)│ 09:00│ --:--│ 0:00 │ --:--    │ --:--│[出勤中]  │          │
│ └──────────┴──────┴──────┴──────┴──────────┴──────┴──────────┘          │
├───────────────────────────────────────────────────────────────────────────┤
│ < 1 2 3 4 5 >                                          20件/ページ ▼   │
└───────────────────────────────────────────────────────────────────────────┘
```

### 「打刻する」ボタン押下時

```
                       ┌──────────────────────┐
 [■ 打刻する ■] ─────→ │ 勤怠打刻モーダル     │
                       │ （SCR-ATT-001）       │
                       └──────────────────────┘
```

> 勤怠打刻モーダルの詳細は `勤怠打刻.md` を参照。

---

## コンポーネント構成

```
DailyAttendanceListPage
├── Breadcrumb
│   └── BreadcrumbItem ("ホーム", "勤怠管理", "日次勤怠一覧")
├── SearchForm (上部固定)
│   ├── EmployeeSelect (社員選択)
│   ├── DateRangePicker (勤務期間)
│   ├── StatusSelect (ステータス)
│   └── ButtonGroup
│       ├── ClearButton (クリア)
│       └── SearchButton (検索)
├── ActionBar
│   ├── ResultCount (検索結果件数)
│   └── ClockInButton ("打刻する" → モーダル起動)
├── DataTable
│   ├── TableHeader (ソート可: 勤務日, 残業, ステータス)
│   ├── TableRow
│   │   ├── WorkDateCell (勤務日 + 曜日)
│   │   ├── TimeCell (出勤時刻)
│   │   ├── TimeCell (退勤時刻)
│   │   ├── DurationCell (休憩時間)
│   │   ├── DurationCell (実労働時間)
│   │   ├── DurationCell (残業時間)
│   │   └── StatusBadge (ステータスバッジ)
│   └── EmptyState ("該当する勤怠データがありません")
├── Pagination
│   ├── PageNumbers
│   └── PageSizeSelector (20件/ページ)
└── ClockInModal (SCR-ATT-001、条件付き表示)
```

---

## 表示項目

### 一覧カラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|------|------|
| workDate | 勤務日 | date | ✅ (デフォルト降順) | 120px | MM/DD(曜) 形式 |
| clockIn | 出勤時刻 | time | - | 80px | HH:mm、未打刻は `--:--` |
| clockOut | 退勤時刻 | time | - | 80px | HH:mm、未打刻は `--:--` |
| breakMinutes | 休憩時間 | duration | - | 80px | H:mm 形式、未打刻は `--:--` |
| netWorkMinutes | 実労働時間 | duration | - | 100px | H:mm 形式、未打刻は `--:--` |
| overtimeMinutes | 残業時間 | duration | ✅ | 80px | H:mm 形式、未打刻は `--:--` |
| status | ステータス | badge | ✅ | 100px | 色分けバッジ |

### ステータスバッジ

| 値 | 表示 | 色 | 背景色 |
|----|------|-----|--------|
| NOT_CLOCKED | 未出勤 | gray-700 | gray-100 |
| CLOCKED_IN | 出勤中 | blue-700 | blue-100 |
| CLOCKED_OUT | 退勤済 | green-700 | green-100 |
| FINALIZED | 確定済 | purple-700 | purple-100 |

---

## 検索条件

| 条件 | フィールド名 | 入力形式 | 演算子 | デフォルト | 備考 |
|------|-------------|---------|--------|-----------|------|
| 社員 | employeeId | セレクト (EmployeeId) | = | ログインユーザー | 上長・人事は他社員を選択可 |
| 勤務期間 | workDate | 日付範囲 (DateRange) | BETWEEN | 当月 (1日〜末日) | カレンダーピッカー |
| ステータス | status | セレクト (AttendanceStatus) | = | 全て | 4つ+全て |

### 社員セレクトの権限制御

| 権限 | 挙動 |
|------|------|
| 本人 | 自分のみ表示（セレクト非表示、固定） |
| 上長 | 配下社員の一覧から選択可 |
| 人事 | 全社員から選択可 |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 検索 | 検索ボタン | 検索条件で一覧再取得 | read (本人+上長+人事) |
| クリア | クリアボタン | 検索条件をデフォルトに戻す | read |
| 打刻する | 打刻するボタン | 勤怠打刻モーダル (SCR-ATT-001) を開く | write (本人のみ) |
| ソート変更 | カラムヘッダークリック | ソート条件変更 + 一覧再取得 | read |
| ページ切替 | ページネーション操作 | ページ変更 + 一覧再取得 | read |

### 行アクション

| アクション | 処理 | 備考 |
|-----------|------|------|
| 行クリック | なし | 将来対応（勤怠詳細画面への遷移） |

---

## 状態管理

```typescript
/** 勤怠ステータス */
type AttendanceStatus =
  | 'NOT_CLOCKED'
  | 'CLOCKED_IN'
  | 'CLOCKED_OUT'
  | 'FINALIZED';

/** ソート方向 */
type SortOrder = 'asc' | 'desc';

/** ソート可能カラム */
type SortableColumn =
  | 'workDate'
  | 'overtimeMinutes'
  | 'status';

/** 勤怠一覧アイテム */
interface AttendanceItem {
  id: string;
  workDate: string;           // ISO 8601 date
  clockIn: string | null;     // ISO 8601 datetime
  clockOut: string | null;    // ISO 8601 datetime
  breakMinutes: number | null;
  netWorkMinutes: number | null;
  overtimeMinutes: number | null;
  status: AttendanceStatus;
}

/** 検索パラメータ */
interface SearchParams {
  employeeId: string;         // デフォルト: ログインユーザー
  workDateFrom: string;       // ISO 8601 date、デフォルト: 当月1日
  workDateTo: string;         // ISO 8601 date、デフォルト: 当月末日
  status: AttendanceStatus | null;  // null = 全て
}

/** ページネーション */
interface PaginationState {
  page: number;               // 現在ページ (1-based)
  size: number;               // 1ページあたり件数 (デフォルト: 20)
  sort: SortableColumn;       // ソートカラム (デフォルト: workDate)
  order: SortOrder;           // ソート方向 (デフォルト: desc)
}

/** 画面全体の状態 */
interface DailyAttendanceListState {
  /** 検索条件 */
  searchParams: SearchParams;

  /** ページネーション */
  pagination: PaginationState;

  /** データ */
  data: {
    content: AttendanceItem[];
    page: {
      number: number;
      size: number;
      totalElements: number;
      totalPages: number;
    };
    isLoading: boolean;
    error: {
      message: string;
      retryAction: (() => void) | null;
    } | null;
  };

  /** 打刻モーダル表示状態 */
  clockInModal: {
    isOpen: boolean;
  };
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------|
| 一覧取得 | `/api/v1/attendances/daily` | GET | employeeId, workDateFrom, workDateTo, status, page, size, sort, order |

### リクエスト例

```
GET /api/v1/attendances/daily
  ?employeeId=EMP-001
  &workDateFrom=2025-01-01
  &workDateTo=2025-01-31
  &status=
  &page=1
  &size=20
  &sort=workDate
  &order=desc
```

### レスポンス例

```json
{
  "content": [
    {
      "id": "ATT-20250115-001",
      "workDate": "2025-01-15",
      "clockIn": "2025-01-15T09:02:00+09:00",
      "clockOut": "2025-01-15T18:03:00+09:00",
      "breakMinutes": 60,
      "netWorkMinutes": 478,
      "overtimeMinutes": 0,
      "status": "FINALIZED"
    }
  ],
  "page": {
    "number": 0,
    "size": 20,
    "totalElements": 31,
    "totalPages": 2
  }
}
```

---

## エラー処理

| エラー | HTTPステータス | 表示方法 | アクション |
|--------|--------------|---------|----------|
| 通信エラー | - | Toast (error) | 再試行ボタン |
| 認証エラー | 401 | リダイレクト | ログイン画面へ |
| 権限エラー | 403 | Toast (error) | 「この社員の勤怠を閲覧する権限がありません」 |
| バリデーションエラー | 422 | Toast (warning) | 検索条件の修正を促す |
| サーバーエラー | 500 | Toast (error) | 再試行ボタン |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | フル表示（全7カラム） |
| Tablet (768-1024px) | 休憩・残業カラム非表示（5カラム） |
| Mobile (<768px) | カード形式に切り替え（勤務日+ステータス+出退勤時刻） |

### Tablet 時の非表示カラム

| カラム | 理由 |
|--------|------|
| breakMinutes | 詳細情報。実労働に含まれる |
| overtimeMinutes | 詳細情報。必要時はDesktopで確認 |

### Mobile カード形式

```
┌──────────────────────────────────┐
│ 01/15(水)              [確定済] │
│ 出勤 09:02  退勤 18:03          │
│ 実労働 7:58                     │
├──────────────────────────────────┤
│ 01/14(火)              [確定済] │
│ 出勤 08:55  退勤 19:30          │
│ 実労働 9:35                     │
└──────────────────────────────────┘
```

---

## デザインガイドライン

> aesthetic: `clean-minimal` / colorScheme: `mono-accent`

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ページ背景 |
| サーフェスカラー | #F9FAFB (gray-50) | 検索フォーム背景 |
| テキスト: Primary | #111827 (gray-900) | 見出し・データ値 |
| テキスト: Secondary | #6B7280 (gray-500) | ラベル・補足 |
| ボーダー | #E5E7EB (gray-200) | テーブル罫線・区切り |
| アクセントカラー | #2563EB (blue-600) | Primary ボタン・ソートアイコン |
| バッジ: 未出勤 | gray-100 / gray-700 | NOT_CLOCKED |
| バッジ: 出勤中 | blue-100 / blue-700 | CLOCKED_IN |
| バッジ: 退勤済 | green-100 / green-700 | CLOCKED_OUT |
| バッジ: 確定済 | purple-100 / purple-700 | FINALIZED |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト | 備考 |
|------|---------|--------|---------|------|
| ページタイトル | system-ui | 24px | 700 | パンくず下 |
| 検索ラベル | system-ui | 12px | 500 | 検索条件ラベル |
| テーブルヘッダー | system-ui | 12px | 600 | カラム名 |
| テーブルデータ | system-ui | 14px | 400 | セルデータ |
| 時刻表示 | monospace | 14px | 400 | HH:mm 形式を等幅で |
| バッジテキスト | system-ui | 12px | 500 | ステータス文字列 |
| 件数表示 | system-ui | 14px | 400 | 「31件」 |
| ボタンラベル | system-ui | 14px | 500 | 検索・打刻する |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| ページ左右パディング | 24px |
| 検索フォーム: パディング | 16px |
| 検索フォーム: 角丸 | 8px |
| セクション間余白 | 16px |
| テーブル行高 | 48px |
| ボタン角丸 | 6px |
| ボタン高さ | 36px |
| バッジ角丸 | 12px (pill) |
| バッジパディング | 2px 10px |
| カード影 | なし（clean-minimal） |
| 区切り線 | 1px solid #E5E7EB |

### インタラクション

| 状態 | スタイル |
|------|---------|
| テーブル行: ホバー | 背景色 gray-50 |
| ソートヘッダー: ホバー | テキスト色 blue-600 + カーソル pointer |
| ソートヘッダー: アクティブ | ▲/▼ アイコン表示 + テキスト色 blue-600 |
| ボタン: ホバー | 背景色 5% 暗く |
| ボタン: disabled | opacity: 0.4 |
| フォーカス | 2px outline (blue-600) + 2px offset |
| ローディング | テーブル部分に Skeleton UI（5行分） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| ページネーション: ホバー | 背景色 gray-100 |
| ページネーション: 現在ページ | 背景色 blue-600 + テキスト白 |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- テーブルのゼブラストライプ（clean-minimalでは罫線のみ）
- 検索条件の過度な装飾（シンプルなフォームで十分）

---

## 品質チェック結果

- [x] 全クエリに対応する表示要素がある（7カラムのDataTable、3条件の検索フォーム、ページネーション）
- [x] 全コマンドに対応する操作UIがある（「打刻する」ボタン → 勤怠打刻モーダル起動）
- [x] エラー状態の表示が定義されている（Toast通知 + 再試行ボタン、権限エラー対応）
- [x] 状態遷移がUI上で表現されている（4種のステータスバッジで色分け表示）

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 一覧
コンポーネント数: 17
DataTable: 1
SearchForm: 1
フォーム数: 1
チャート数: 0
-->
