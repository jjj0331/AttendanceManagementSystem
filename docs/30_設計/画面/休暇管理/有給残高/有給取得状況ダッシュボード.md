# 有給取得状況ダッシュボード

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-LB-002 |
| 画面種別 | ダッシュボード |
| 関連集約 | 有給残高 |
| URL | `/leave-balances/dashboard` |
| コンテキスト | 休暇管理 |
| 認可 | 上長 + 人事 |

---

## ワイヤーフレーム

```
┌────────────────────────────────────────────────────────────────────┐
│ 勤怠管理システム                                       [user ▼]   │
├────────────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 休暇管理 > 有給取得状況ダッシュボード            │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│ ┌── フィルター ──────────────────────────────────────────────────┐ │
│ │ [部署 ▼ (上長の部署)]  [年度 ▼ (当年度)]  [義務達成 ▼ (全て)] │ │
│ │                                            [検索] [クリア]     │ │
│ └────────────────────────────────────────────────────────────────┘ │
│                                                                    │
│ ┌─── KPI ────────┐ ┌─── KPI ────────┐ ┌─── KPI ────────┐ ┌─── KPI ────────┐ │
│ │ 対象従業員数    │ │ 平均消化日数    │ │ 義務達成率      │ │ 義務未達者数    │ │
│ │                │ │                │ │                │ │                │ │
│ │    25 名       │ │   8.5 日       │ │   80.0 %       │ │    ⚠ 5 名      │ │
│ └────────────────┘ └────────────────┘ └────────────────┘ └────────────────┘ │
│                                                                    │
│ ┌─── 義務達成状況 ────────────────────────────────────────┐       │
│ │                                                         │       │
│ │   達成 ████████████████████░░░░░ 未達   80% / 20%       │       │
│ │                                                         │       │
│ │   ● 達成: 20名    ● 未達: 5名                           │       │
│ └─────────────────────────────────────────────────────────┘       │
│                                                                    │
│ ┌─── 従業員一覧 ──────────────────────────────────────────┐       │
│ │ 件数: 25件                    [特別休暇付与][残高調整]※  │       │
│ │ ※人事権限のみ表示                                        │       │
│ ├─────────────────────────────────────────────────────────┤       │
│ │ 従業員名 ▲ │付与日数│消化日数 ▼│残日数 ▼│年5日義務│次の時効日 ▼│操作│ │
│ ├────────────┼────────┼─────────┼────────┼────────┼───────────┼──┤ │
│ │ 山田太郎   │ 20.0   │  5.0    │ 15.0   │ ● 達成 │ 2025/09/30│⋮ │ │
│ │ 鈴木花子   │ 20.0   │  3.0    │ 17.0   │ ⚠ 未達 │ 2025/03/31│⋮ │ │
│ │ 佐藤次郎   │ 10.0   │  8.0    │  2.0   │ ● 達成 │ 2025/12/31│⋮ │ │
│ └────────────┴────────┴─────────┴────────┴────────┴───────────┴──┘ │
│                                                                    │
│ < 1 2 ... 2 >                                   20件/ページ ▼     │
│                                                                    │
│ 最終更新: 2025/01/15 10:30                        [↻ 更新]        │
└────────────────────────────────────────────────────────────────────┘
```

### モーダル: 特別休暇付与

```
┌─── 特別休暇付与 ────────────────────────┐
│                                          │
│ 対象従業員: 山田太郎                      │
│                                          │
│ 休暇種別    [─────────────── ▼]          │
│             慶弔/リフレッシュ/その他       │
│                                          │
│ 付与日数    [______] 日                  │
│                                          │
│ 有効期限    [____/____/____]             │
│                                          │
│              [キャンセル]  [付与する]      │
└──────────────────────────────────────────┘
```

### モーダル: 有給残高調整

```
┌─── 有給残高調整 ────────────────────────┐
│                                          │
│ 対象従業員: 山田太郎                      │
│                                          │
│ 調整種別    [─────────────── ▼]          │
│             加算/減算                     │
│                                          │
│ 調整日数    [______] 日                  │
│                                          │
│ 理由        [________________________]   │
│             [________________________]   │
│             [________________________]   │
│                                          │
│              [キャンセル]  [調整する]      │
└──────────────────────────────────────────┘
```

---

## コンポーネント構成

```
PaidLeaveDashboardPage
├── Header
│   ├── Breadcrumb (ホーム > 休暇管理 > 有給取得状況ダッシュボード)
│   └── UserMenu
├── FilterForm
│   ├── SelectBox (departmentId: 部署)
│   ├── SelectBox (fiscalYear: 年度)
│   ├── SelectBox (obligationMet: 義務達成)
│   └── ButtonGroup (search, clear)
├── KpiCardGrid
│   ├── KpiCard (対象従業員数: totalEmployees)
│   │   ├── MetricLabel
│   │   └── MetricValue (単位: 名)
│   ├── KpiCard (平均消化日数: avgConsumedDays)
│   │   ├── MetricLabel
│   │   └── MetricValue (単位: 日)
│   ├── KpiCard (義務達成率: obligationMetRate)
│   │   ├── MetricLabel
│   │   └── MetricValue (単位: %)
│   └── KpiCard (義務未達者数: obligationNotMetCount)
│       ├── MetricLabel
│       ├── MetricValue (単位: 名)
│       └── AlertBadge (未達者がいる場合)
├── ObligationChart
│   ├── DonutBar (達成/未達の割合)
│   └── Legend (達成: N名, 未達: N名)
├── EmployeeDataSection
│   ├── ActionBar
│   │   ├── ResultCount
│   │   ├── GrantSpecialLeaveButton (人事のみ)
│   │   └── AdjustBalanceButton (人事のみ)
│   ├── DataTable
│   │   ├── TableHeader (sortable columns)
│   │   ├── TableRow
│   │   │   ├── DataCell (employeeName)
│   │   │   ├── DataCell (grantedDays)
│   │   │   ├── DataCell (consumedDays)
│   │   │   ├── DataCell (remainingDays)
│   │   │   ├── ObligationBadge (達成/未達 + アラート)
│   │   │   ├── DataCell (nextExpiryDate)
│   │   │   └── ActionMenu (⋮)
│   │   │       ├── GrantSpecialLeaveAction (人事のみ)
│   │   │       └── AdjustBalanceAction (人事のみ)
│   │   └── EmptyState
│   └── Pagination
│       ├── PageNumbers
│       └── PageSizeSelector
├── RefreshControl
│   ├── LastUpdated
│   └── RefreshButton
├── GrantSpecialLeaveModal
│   ├── EmployeeInfo (読み取り専用)
│   ├── SelectBox (type: 休暇種別)
│   ├── NumberInput (days: 付与日数)
│   ├── DatePicker (expiryDate: 有効期限)
│   └── ButtonGroup (cancel, submit)
└── AdjustBalanceModal
    ├── EmployeeInfo (読み取り専用)
    ├── SelectBox (type: 調整種別 加算/減算)
    ├── NumberInput (days: 調整日数)
    ├── TextArea (reason: 理由)
    └── ButtonGroup (cancel, submit)
```

---

## 表示項目

### KPIカード

| 指標 | データソース | フィールド | 単位 | 更新頻度 |
|------|------------|-----------|------|---------|
| 対象従業員数 | kpi.totalEmployees | totalEmployees | 名 | 手動 |
| 平均消化日数 | kpi.avgConsumedDays | avgConsumedDays | 日 | 手動 |
| 義務達成率 | kpi.obligationMetRate | obligationMetRate | % | 手動 |
| 義務未達者数 | kpi.obligationNotMetCount | obligationNotMetCount | 名 | 手動 |

### 集計エリア

| 集計 | 表示形式 | データソース | 備考 |
|------|---------|------------|------|
| 義務達成/未達の割合 | ドーナツバー（横型プログレスバー） | kpi.obligationMetCount / obligationNotMetCount | 達成=アクセントカラー、未達=Warning |
| 達成者数/未達者数 | 凡例テキスト | kpi | 名数を併記 |

### 従業員一覧カラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|-----|------|
| employeeName | 従業員名 | text | ✅ (デフォルト asc) | 140px | - |
| grantedDays | 付与日数 | number | - | 90px | 小数1桁 |
| consumedDays | 消化日数 | number | ✅ | 90px | 小数1桁 |
| remainingDays | 残日数 | number | ✅ | 90px | 小数1桁 |
| obligationMet | 年5日義務 | badge | ✅ | 110px | 達成/未達バッジ |
| nextExpiryDate | 次の時効日 | date | ✅ | 120px | YYYY/MM/DD |
| actions | 操作 | menu | - | 48px | 人事のみ表示 |

### 義務達成バッジ

| 値 | 表示 | 色 | 備考 |
|----|------|-----|------|
| true | ● 達成 | Success (#10B981) | - |
| false | ⚠ 未達 | Warning (#F59E0B) | アラートバッジ付き |

---

## 検索条件（フィルター）

| 条件 | 入力形式 | 演算子 | デフォルト | 備考 |
|------|---------|--------|-----------|------|
| 部署 | セレクト | = | 上長の部署（上長）/ 全部署（人事） | 上長は自部署固定、人事は全部署選択可 |
| 年度 | セレクト | = | 当年度 | 過去3年度分を選択可 |
| 義務達成 | セレクト | = | 全て | 全て / 達成 / 未達 |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 検索 | 検索ボタン / フィルター変更 | ダッシュボード再取得 | read (上長+人事) |
| クリア | クリアボタン | フィルターをデフォルトに戻す | read (上長+人事) |
| 更新 | 更新ボタン | API再取得 | read (上長+人事) |

### 行アクション（人事のみ）

| アクション | トリガー | 処理 | 確認 | 権限 |
|-----------|---------|------|------|------|
| 特別休暇付与 | ActionBar ボタン or 行メニュー | GrantSpecialLeaveModal表示 | モーダル内で確認 | 人事のみ |
| 有給残高調整 | ActionBar ボタン or 行メニュー | AdjustBalanceModal表示 | モーダル内で確認 | 人事のみ |

### モーダルアクション

#### 特別休暇付与モーダル

| フィールド | 型 | 必須 | バリデーション |
|-----------|-----|------|--------------|
| type | セレクト（休暇種別） | ✅ | 慶弔/リフレッシュ/その他 |
| days | 数値 | ✅ | 0.5〜99.0、0.5刻み |
| expiryDate | 日付 | ✅ | 未来日のみ |

- API: `POST /api/v1/paid-leave-balances/{id}/actions/grant-special`
- 成功時: Toast「特別休暇を付与しました」→ ダッシュボード再取得
- 失敗時: モーダル内にエラー表示

#### 有給残高調整モーダル

| フィールド | 型 | 必須 | バリデーション |
|-----------|-----|------|--------------|
| employeeId | hidden | ✅ | 対象従業員ID（自動セット） |
| type | セレクト（調整種別） | ✅ | 加算/減算 |
| days | 数値 | ✅ | 0.5〜99.0、0.5刻み |
| reason | テキストエリア | ✅ | 1〜500文字 |

- API: `POST /api/v1/paid-leave-balances/{id}/actions/adjust`
- 成功時: Toast「有給残高を調整しました」→ ダッシュボード再取得
- 失敗時: モーダル内にエラー表示

---

## 状態管理

```typescript
interface PaidLeaveDashboardState {
  // フィルター
  filters: {
    departmentId: string | null;
    fiscalYear: string;
    obligationMet: boolean | null; // null = 全て
  };

  // ページネーション
  pagination: {
    page: number;       // 0始まり
    size: number;       // デフォルト: 20
    sort: string;       // デフォルト: "employeeName"
    order: 'asc' | 'desc';
  };

  // KPI
  kpi: {
    totalEmployees: number;
    avgConsumedDays: number;
    obligationMetCount: number;
    obligationNotMetCount: number;
    obligationMetRate: number;
    isLoading: boolean;
  };

  // 従業員一覧
  employeeList: {
    items: PaidLeaveEmployee[];
    totalCount: number;
    totalPages: number;
    isLoading: boolean;
    error: Error | null;
  };

  // 更新制御
  refresh: {
    lastUpdated: Date | null;
    isRefreshing: boolean;
  };

  // モーダル
  grantSpecialLeaveModal: {
    isOpen: boolean;
    targetEmployee: PaidLeaveEmployee | null;
    form: {
      type: string;
      days: number | null;
      expiryDate: string;
    };
    isSubmitting: boolean;
    error: Error | null;
  };

  adjustBalanceModal: {
    isOpen: boolean;
    targetEmployee: PaidLeaveEmployee | null;
    form: {
      type: 'add' | 'subtract';
      days: number | null;
      reason: string;
    };
    isSubmitting: boolean;
    error: Error | null;
  };
}

interface PaidLeaveEmployee {
  employeeId: string;
  employeeName: string;
  grantedDays: number;
  consumedDays: number;
  remainingDays: number;
  obligationMet: boolean;
  nextExpiryDate: string; // ISO 8601
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | パラメータ |
|------|--------------|---------|-----------|
| ダッシュボード取得 | `/api/v1/paid-leave-balances/dashboard` | GET | departmentId?, fiscalYear?, obligationMet?, page, size, sort |
| 特別休暇付与 | `/api/v1/paid-leave-balances/{id}/actions/grant-special` | POST | { type, days, expiryDate } |
| 有給残高調整 | `/api/v1/paid-leave-balances/{id}/actions/adjust` | POST | { employeeId, type, days, reason } |

### レスポンス構造（ダッシュボード取得）

```json
{
  "kpi": {
    "totalEmployees": 25,
    "avgConsumedDays": 8.5,
    "obligationMetCount": 20,
    "obligationNotMetCount": 5,
    "obligationMetRate": 80.0
  },
  "content": [
    {
      "employeeId": "EMP001",
      "employeeName": "山田太郎",
      "grantedDays": 20.0,
      "consumedDays": 5.0,
      "remainingDays": 15.0,
      "obligationMet": true,
      "nextExpiryDate": "2025-09-30"
    }
  ],
  "page": {
    "number": 0,
    "size": 20,
    "totalElements": 25,
    "totalPages": 2
  }
}
```

---

## エラー処理

| エラー | 表示方法 | アクション |
|--------|---------|----------|
| 通信エラー (5xx) | Toast (error) | 再試行ボタン表示 |
| 認証エラー (401) | リダイレクト | ログイン画面へ |
| 認可エラー (403) | Toast (error) + 画面遷移 | 権限がありません → ホームへ |
| バリデーションエラー (400) | モーダル内フィールドエラー | 該当フィールドをハイライト |
| データなし | EmptyState コンポーネント | 「該当するデータがありません」 |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | KPIカード4列横並び、チャート+テーブルフル表示 |
| Tablet (768-1024px) | KPIカード2列2行、テーブルは付与日数カラム非表示 |
| Mobile (<768px) | KPIカード1列、テーブルは横スクロール、モーダルはフルスクリーン |

---

## デザインガイドライン

> デザイン方針: **clean-minimal** / **mono-accent**

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | 背景はホワイト基調 |
| サーフェスカラー | #F9FAFB | カード・セクション背景 |
| テキストカラー | #111827 | メインテキスト |
| セカンダリテキスト | #6B7280 | ラベル・補助テキスト |
| ボーダーカラー | #E5E7EB | 区切り線・枠線 |
| アクセントカラー | #3B82F6 | プライマリアクション・達成率バー |
| セマンティック: Success | #10B981 | 義務達成バッジ |
| セマンティック: Warning | #F59E0B | 義務未達バッジ・アラート |
| セマンティック: Error | #EF4444 | エラー状態 |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

**mono-accent 方針:**
- グレースケール（#F9FAFB 〜 #111827）を基調とする
- アクセントカラー（#3B82F6）は1色のみ使用
- セマンティックカラーはステータス表示にのみ限定使用
- 彩度を抑え、情報の優先度を余白とウェイトで表現

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト |
|------|---------|--------|---------|
| 画面タイトル（h1） | system-ui | 24px | 700 |
| セクション見出し（h2） | system-ui | 18px | 600 |
| KPI数値 | "SF Mono", monospace | 32px | 700 |
| KPIラベル | system-ui | 13px | 500 |
| KPI単位 | system-ui | 14px | 400 |
| テーブルヘッダー | system-ui | 12px | 600 |
| テーブルセル | system-ui | 14px | 400 |
| フィルターラベル | system-ui | 12px | 500 |
| ボタン | system-ui | 14px | 500 |

### レイアウト原則

| 項目 | 値 | 備考 |
|------|-----|------|
| 基本余白 | 8px グリッド | clean-minimal: 余白を広めに |
| セクション間 | 32px | 通常(24px)より広め |
| KPIカード間 | 16px | - |
| カード内パディング | 24px | - |
| カード角丸 | 8px | - |
| ボタン角丸 | 6px | - |
| カード影 | 0 1px 3px rgba(0,0,0,0.08) | 控えめなシャドウ |
| 区切り線 | 1px solid #E5E7EB | - |
| 最大コンテンツ幅 | 1280px | 中央寄せ |

**clean-minimal 方針:**
- ホワイトスペースを十分に確保し、要素を詰め込まない
- 不要なボーダーや装飾を排除
- カード影は最小限（ほぼフラット）
- KPIカードは数値を大きく、ラベルは控えめに
- 視覚的な階層はフォントサイズ・ウェイト・余白で表現

### インタラクション

| 状態 | スタイル |
|------|---------|
| ホバー（テーブル行） | 背景色 #F9FAFB |
| ホバー（ボタン） | opacity: 0.9 |
| フォーカス | 2px outline #3B82F6 + 2px offset |
| ローディング | Skeleton UI（KPIカード + テーブル） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| ソート切替 | ヘッダークリック → ▲/▼ 表示切替 |
| フィルター適用 | 検索ボタンクリックでAPI再取得 |
| モーダル表示 | オーバーレイ + フェードイン（150ms） |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- KPIカードへの不要なアイコン装飾
- チャートの過度な色使い（mono-accent に反する）

---

## 権限による表示制御

| 要素 | 上長 | 人事 |
|------|------|------|
| フィルター: 部署 | 自部署固定（変更不可） | 全部署選択可 |
| KPIカード | ✅ | ✅ |
| 集計エリア | ✅ | ✅ |
| 従業員一覧 | ✅（自部署のみ） | ✅（全部署） |
| 特別休暇付与ボタン | - | ✅ |
| 有給残高調整ボタン | - | ✅ |
| 行メニュー | - | ✅ |

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: ダッシュボード
コンポーネント数: 28
DataTable: 1
SearchForm: 1
フォーム数: 2
チャート数: 1
-->
