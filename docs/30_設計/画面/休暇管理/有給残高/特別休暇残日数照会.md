# 特別休暇残日数照会

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-LB-003 |
| 画面種別 | 詳細（照会） |
| 関連集約 | 有給残高 |
| コンテキスト | 休暇管理 |
| URL | `/leave-balances/special-remaining` |
| 権限 | 本人（自分の残日数）/ 人事（全従業員の残日数） |

---

## ワイヤーフレーム

```
┌──────────────────────────────────────────────────────────────┐
│ 勤怠管理システム                              [山田 太郎 ▼]  │
├──────────────────────────────────────────────────────────────┤
│ パンくず: ホーム > 休暇管理 > 有給残高 > 特別休暇残日数照会  │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  特別休暇残日数照会                                          │
│                                                              │
│  ※人事ロール時のみ表示:                                      │
│  ┌──────────────────────────────────────┐                    │
│  │ 従業員  [従業員選択 ▼]  [照会]       │                    │
│  └──────────────────────────────────────┘                    │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┬──────────┬──────────┬──────────┬────────────┐  │
│  │ 特別休暇 │ 付与日数 │ 消化日数 │  残日数  │  有効期限  │  │
│  │  種別    │          │          │          │            │  │
│  ├──────────┼──────────┼──────────┼──────────┼────────────┤  │
│  │ 慶弔休暇 │   5.0日  │   2.0日  │   3.0日  │ 2025/06/30 │  │
│  ├──────────┼──────────┼──────────┼──────────┼────────────┤  │
│  │ リフレッ │   3.0日  │   0.0日  │   3.0日  │ 2025/03/15 │  │
│  │ シュ休暇 │          │          │          │ ⚠ 期限間近 │  │
│  └──────────┴──────────┴──────────┴──────────┴────────────┘  │
│                                                              │
│  ──────────────────────────────────────────────────────────  │
│  合計          8.0日      2.0日      6.0日                   │
│                                                              │
│  ⚠ 有効期限が30日以内の休暇があります                        │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│  ※ 特別休暇は日単位（全日/半日）での取得のみ可能です         │
│  ※ 時間単位での取得はできません                               │
└──────────────────────────────────────────────────────────────┘
```

---

## コンポーネント構成

```
SpecialLeaveRemainingPage
├── PageHeader
│   ├── Breadcrumb
│   └── PageTitle ("特別休暇残日数照会")
├── EmployeeSelector (人事ロール時のみ表示)
│   ├── SelectBox (employeeId)
│   └── QueryButton
├── LeaveBalanceTable
│   ├── TableHeader
│   │   ├── HeaderCell ("特別休暇種別")
│   │   ├── HeaderCell ("付与日数")
│   │   ├── HeaderCell ("消化日数")
│   │   ├── HeaderCell ("残日数")
│   │   └── HeaderCell ("有効期限", sortable)
│   ├── TableRow
│   │   ├── LeaveTypeCell
│   │   ├── NumericCell (grantedDays)
│   │   ├── NumericCell (consumedDays)
│   │   ├── NumericCell (remainingDays)
│   │   └── ExpiryDateCell
│   │       ├── DateDisplay
│   │       └── ExpiryWarningBadge (30日以内で表示)
│   ├── TableFooter
│   │   └── TotalRow (付与日数合計, 消化日数合計, 残日数合計)
│   └── EmptyState
├── ExpiryAlert (期限間近の休暇がある場合)
└── InfoNote (利用制限の注意書き)
```

---

## 表示項目

### テーブルカラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|------|------|
| type | 特別休暇種別 | text | - | 160px | 種別名を日本語表示 |
| grantedDays | 付与日数 | numeric | - | 100px | 小数第1位、右寄せ |
| consumedDays | 消化日数 | numeric | - | 100px | 小数第1位、右寄せ |
| remainingDays | 残日数 | numeric | - | 100px | 小数第1位、右寄せ、太字 |
| expiryDate | 有効期限 | date | ✅ (default: asc) | 140px | YYYY/MM/DD形式 |

### 特別休暇種別の表示マッピング

| enum値 | 表示名 |
|--------|--------|
| SPECIAL_BEREAVEMENT | 慶弔休暇 |
| SPECIAL_REFRESH | リフレッシュ休暇 |

### 有効期限バッジ

| 条件 | 表示 | 色 |
|------|------|-----|
| 期限まで30日超 | （なし） | - |
| 期限まで30日以内 | ⚠ 期限間近 | warning（amber） |
| 期限切れ | 期限切れ | error（red） |

---

## 検索条件

| 条件 | 入力形式 | 演算子 | デフォルト | 備考 |
|------|---------|--------|-----------|------|
| employeeId | 自動設定 / セレクト | = | ログインユーザー | 人事ロールのみ変更可 |
| type | 固定 | = | 全SPECIAL_*種別 | フィルタUIなし（全種別表示） |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 | 備考 |
|-----------|---------|------|------|------|
| 初期表示 | ページロード | 残日数データ取得 | read | ログインユーザーのデータ自動取得 |
| 従業員切替 | 照会ボタン | 残日数データ再取得 | read（人事） | 人事ロール時のみ |
| ソート | 有効期限ヘッダクリック | テーブル再ソート | - | クライアントサイドソート |

### 行アクション

なし（照会専用画面のため）

---

## 状態管理

```typescript
interface SpecialLeaveRemainingPageState {
  // 検索パラメータ
  query: {
    employeeId: string;         // ログインユーザーIDまたは選択された従業員ID
    type: LeaveType[] | null;   // null = 全SPECIAL_*種別
  };

  // ソート状態
  sort: {
    field: 'expiryDate';
    order: 'asc' | 'desc';
  };

  // データ
  data: {
    employeeId: string;
    specialLeaves: SpecialLeaveBalance[];
    isLoading: boolean;
    error: ApiError | null;
  };

  // 権限
  auth: {
    isHrRole: boolean;          // 人事ロールか
    canSelectEmployee: boolean; // 従業員選択が可能か
  };
}

interface SpecialLeaveBalance {
  type: LeaveType;
  grantedDays: number;
  consumedDays: number;
  remainingDays: number;
  expiryDate: string;           // ISO 8601
  isExpiringSoon: boolean;      // 30日以内フラグ（算出）
}

type LeaveType =
  | 'SPECIAL_BEREAVEMENT'
  | 'SPECIAL_REFRESH';
```

---

## API連携

| 操作 | エンドポイント | メソッド | 備考 |
|------|--------------|---------|------|
| 特別休暇残日数取得 | `/api/v1/paid-leave-balances/special-remaining` | GET | パラメータ: employeeId?, type? |

### リクエスト例

```
GET /api/v1/paid-leave-balances/special-remaining
GET /api/v1/paid-leave-balances/special-remaining?employeeId=EMP-001
```

### レスポンス例

```json
{
  "employeeId": "EMP-001",
  "specialLeaves": [
    {
      "type": "SPECIAL_BEREAVEMENT",
      "grantedDays": 5.0,
      "consumedDays": 2.0,
      "remainingDays": 3.0,
      "expiryDate": "2025-06-30"
    },
    {
      "type": "SPECIAL_REFRESH",
      "grantedDays": 3.0,
      "consumedDays": 0.0,
      "remainingDays": 3.0,
      "expiryDate": "2025-03-15"
    }
  ]
}
```

### データソース

- `leave_grants` テーブル + `leave_balance_summaries` テーブルを結合
- 種別ごとに独立して消化（INV-LB-005）

---

## エラー処理

| エラー | 表示方法 | アクション |
|--------|---------|----------|
| 通信エラー | トースト通知 | 再試行ボタン表示 |
| 認証エラー (401) | リダイレクト | ログイン画面へ |
| 権限エラー (403) | インライン警告 | 「この従業員の情報を閲覧する権限がありません」 |
| データなし | EmptyState | 「特別休暇のデータがありません」 |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | テーブルフル表示 |
| Tablet (768-1024px) | テーブルフル表示（余白調整） |
| Mobile (<768px) | カード形式に切り替え（種別ごとにカード化） |

### モバイルカードレイアウト

```
┌──────────────────────────┐
│ 慶弔休暇                 │
│ ─────────────────────── │
│ 付与日数      5.0日      │
│ 消化日数      2.0日      │
│ 残日数        3.0日      │
│ 有効期限  2025/06/30     │
└──────────────────────────┘
┌──────────────────────────┐
│ リフレッシュ休暇         │
│ ─────────────────────── │
│ 付与日数      3.0日      │
│ 消化日数      0.0日      │
│ 残日数        3.0日      │
│ 有効期限  2025/03/15     │
│         ⚠ 期限間近       │
└──────────────────────────┘
```

---

## デザインガイドライン

### カラー＆テーマ

> **方針: mono-accent** — グレースケール基調 + 1色のアクセントカラー

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | 背景 |
| サーフェスカラー | #F9FAFB | テーブル背景・カード背景 |
| テキストカラー | #111827 | 本文 |
| サブテキスト | #6B7280 | ラベル・補助テキスト |
| ボーダーカラー | #E5E7EB | 区切り線・テーブル罫線 |
| アクセントカラー | #3B82F6 | リンク・アクティブ要素 |
| セマンティック: Warning | #F59E0B | 期限間近バッジ |
| セマンティック: Error | #EF4444 | 期限切れバッジ |
| セマンティック: Success | #10B981 | （将来拡張用） |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト |
|------|---------|--------|---------|
| 見出し（h1） | system-ui | 24px | 700 |
| 見出し（h2） | system-ui | 20px | 600 |
| 本文 | system-ui | 14px | 400 |
| ラベル | system-ui | 12px | 500 |
| 数値（日数） | monospace | 16px | 700 |
| 合計行 | system-ui | 14px | 600 |
| 注意書き | system-ui | 12px | 400 |

### レイアウト原則

> **方針: clean-minimal** — 余白重視、要素を減らす、ホワイトスペース活用

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| セクション間 | 24px |
| テーブルセルpadding | 12px 16px |
| カード角丸 | 8px |
| ボタン角丸 | 6px |
| カード影 | 0 1px 3px rgba(0,0,0,0.1) |
| 区切り線 | 1px solid #E5E7EB |
| コンテンツ最大幅 | 800px（中央寄せ） |

### インタラクション

| 状態 | スタイル |
|------|---------|
| ホバー（テーブル行） | 背景色 #F3F4F6 |
| フォーカス | 2px outline #3B82F6 + 2px offset |
| ローディング | Skeleton UI（テーブル行3行分） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| 期限警告バッジ | 静的表示（アニメーションなし） |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- 期限警告の過剰な点滅・アニメーション
- データが少ないのにページネーションを配置

---

## 業務ルール・補足

| ルール | 内容 |
|--------|------|
| 消化単位 | 全日（FULL_DAY）/ 半日（HALF_DAY）のみ。時間単位不可 |
| 種別独立消化 | 種別ごとに独立して消化される（INV-LB-005） |
| 期限警告閾値 | 有効期限まで30日以内で警告表示 |
| 権限制御 | 本人は自分のデータのみ閲覧可。人事は全従業員を照会可 |

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: 詳細
コンポーネント数: 14
DataTable: 1
SearchForm: 0
フォーム数: 0
チャート数: 0
-->
