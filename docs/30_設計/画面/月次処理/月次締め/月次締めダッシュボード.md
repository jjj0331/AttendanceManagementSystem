# 月次締めダッシュボード

## 概要

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-MC-001 |
| 画面種別 | ダッシュボード |
| 関連集約 | 月次締め |
| コンテキスト | 月次処理 |
| URL | `/monthly-closings/dashboard` |

---

## ワイヤーフレーム

```
┌───────────────────────────────────────────────────────────────────┐
│ 月次締めダッシュボード                           [user ▼]          │
├───────────────────────────────────────────────────────────────────┤
│ ┌─── KPI ───────┐ ┌─── KPI ───────┐ ┌─── KPI ───────┐         │
│ │ 当月ステータス │ │ 未打刻件数     │ │ 未承認件数     │         │
│ │  仮締め済      │ │     12件       │ │     5件       │         │
│ └────────────────┘ └────────────────┘ └────────────────┘         │
│ ┌─── KPI ───────┐ ┌─── KPI ───────┐                           │
│ │ フレックス不足 │ │ FINALIZED済み │                           │
│ │     3名       │ │    11ヶ月     │                           │
│ └────────────────┘ └────────────────┘                           │
├───────────────────────────────────────────────────────────────────┤
│ ┌─── フィルタ ───────────────────────────────────────────────┐   │
│ │ [期間開始▼] [期間終了▼] [ステータス▼]  [検索] [クリア]   │   │
│ └────────────────────────────────────────────────────────────┘   │
├───────────────────────────────────────────────────────────────────┤
│ 件数: 12件                                  最終更新: 2026-02-09 │
├───────────────────────────────────────────────────────────────────┤
│ ┌──────┬────────┬──────┬──────┬──────┬──────┬──────┬──────┐   │
│ │対象月│ステータス│対象者│未打刻│未承認│不足者│エクス│ 操作 │   │
│ │  ▼  │        │ 数   │      │      │      │ポート│      │   │
│ ├──────┼────────┼──────┼──────┼──────┼──────┼──────┼──────┤   │
│ │2026/2│仮締め済 │  120 │   12 │    5 │    3 │  -   │[仮締]│   │
│ │      │        │      │      │      │      │      │[本締]│   │
│ ├──────┼────────┼──────┼──────┼──────┼──────┼──────┼──────┤   │
│ │2026/1│ 確定    │  120 │    0 │    0 │    0 │ 完了 │  -   │   │
│ ├──────┼────────┼──────┼──────┼──────┼──────┼──────┼──────┤   │
│ │2025/12│確定    │  118 │    0 │    0 │    1 │ 完了 │  -   │   │
│ └──────┴────────┴──────┴──────┴──────┴──────┴──────┴──────┘   │
├───────────────────────────────────────────────────────────────────┤
│ < 1 2 3 ... 12 >                              20件/ページ ▼      │
└───────────────────────────────────────────────────────────────────┘
```

---

## コンポーネント構成

```
MonthlyClosingDashboardPage
├── Header
│   └── UserMenu
├── KpiCardGrid
│   ├── KpiCard (当月ステータス)
│   │   ├── MetricLabel
│   │   ├── MetricValue (Badge)
│   │   └── TrendIndicator (不要)
│   ├── KpiCard (未打刻件数)
│   │   ├── MetricLabel
│   │   ├── MetricValue
│   │   └── AlertIndicator (0以外で表示)
│   ├── KpiCard (未承認件数)
│   │   ├── MetricLabel
│   │   ├── MetricValue
│   │   └── AlertIndicator (0以外で表示)
│   ├── KpiCard (フレックス不足者数)
│   │   ├── MetricLabel
│   │   ├── MetricValue
│   │   └── AlertIndicator (0以外で表示)
│   └── KpiCard (FINALIZED済み月数)
│       ├── MetricLabel
│       └── MetricValue
├── FilterForm
│   ├── MonthRangeSelect (開始・終了)
│   ├── StatusSelect (複数選択)
│   └── ButtonGroup (search, clear)
├── ActionBar
│   ├── ResultCount
│   └── LastUpdated
├── DataTable
│   ├── TableHeader (sortable)
│   ├── TableRow
│   │   ├── DataCell (month)
│   │   ├── DataCell (status - Badge)
│   │   ├── DataCell (totalEmployees)
│   │   ├── DataCell (missingClockCount)
│   │   ├── DataCell (pendingApprovalCount)
│   │   ├── DataCell (flexDeficitCount)
│   │   ├── DataCell (exportStatus - Badge)
│   │   └── ActionCell (preliminary-close, finalize)
│   └── EmptyState
└── Pagination
    ├── PageNumbers
    └── PageSizeSelector
```

---

## 表示項目

### KPIカード

| 指標 | データソース | 更新頻度 | 備考 |
|------|------------|---------|------|
| 当月ステータス | `GET /api/v1/monthly-closings/dashboard` (kpi.currentMonthStatus) | 手動 | Badge表示 |
| 未打刻件数 | 同上 (kpi.totalMissingClockCount) | 手動 | 0以外でアラート色 |
| 未承認件数 | 同上 (kpi.totalPendingApprovalCount) | 手動 | 0以外でアラート色 |
| フレックス不足者数 | 同上 (kpi.flexDeficitEmployeeCount) | 手動 | 0以外でアラート色 |
| FINALIZED済み月数 | 同上 (kpi.finalizedMonthCount) | 手動 | - |

### テーブルカラム

| カラム | 表示名 | 型 | ソート | 幅 | 備考 |
|--------|--------|-----|--------|-----|------|
| month | 対象月 | date(YYYY/MM) | ✅ desc | 100px | デフォルトソート |
| status | 締めステータス | badge | ✅ | 120px | 色分け |
| totalEmployees | 対象従業員数 | number | - | 90px | - |
| missingClockCount | 未打刻件数 | number | ✅ | 90px | 0以外でアラート色 |
| pendingApprovalCount | 未承認件数 | number | ✅ | 90px | 0以外でアラート色 |
| flexDeficitCount | フレックス不足者数 | number | - | 120px | - |
| exportStatus | エクスポート状況 | badge | - | 120px | 色分け |
| actions | 操作 | button-group | - | 100px | 条件付き活性 |

### ステータスバッジ

| 値 | 表示 | 色 |
|----|------|-----|
| NOT_STARTED | 未着手 | gray |
| PRELIMINARY_CLOSED | 仮締め済 | yellow |
| FINALIZED | 確定 | green |

### エクスポートステータスバッジ

| 値 | 表示 | 色 |
|----|------|-----|
| null | - | - |
| PROCESSING | 処理中 | blue |
| COMPLETED | 完了 | green |
| FAILED | 失敗 | red |

---

## 検索条件

| 条件 | 入力形式 | 演算子 | デフォルト |
|------|---------|--------|-----------|
| 期間開始年月 | 月選択(YYYY-MM) | >= | 12ヶ月前 |
| 期間終了年月 | 月選択(YYYY-MM) | <= | 当月 |
| 締めステータス | セレクト（複数） | IN | 全て |

---

## アクション

### 画面アクション

| アクション | トリガー | 処理 | 権限 |
|-----------|---------|------|------|
| 検索 | 検索ボタン | 一覧再取得 | hr:monthly-closing:read |
| 手動更新 | 更新ボタン（右上） | 一覧再取得 | hr:monthly-closing:read |

### 行アクション

| アクション | 処理 | 確認 | 権限 | 活性条件 |
|-----------|------|------|------|---------|
| 仮締め | `POST /api/v1/monthly-closings/actions/preliminary-close` | ダイアログ | hr:monthly-closing:preliminary-close | `status` が `NOT_STARTED` または `PRELIMINARY_CLOSED` |
| 本締め | `POST /api/v1/monthly-closings/actions/finalize` | ダイアログ | hr:monthly-closing:finalize | `status` が `PRELIMINARY_CLOSED` かつ `missingClockCount=0` かつ `pendingApprovalCount=0` |

---

## 状態管理

```typescript
interface MonthlyClosingDashboardState {
  kpiCards: {
    currentMonthStatus: 'NOT_STARTED' | 'PRELIMINARY_CLOSED' | 'FINALIZED' | null;
    totalMissingClockCount: number;
    totalPendingApprovalCount: number;
    flexDeficitEmployeeCount: number;
    finalizedMonthCount: number;
    isLoading: boolean;
    error: Error | null;
  };
  filterForm: {
    monthFrom: string; // YYYY-MM
    monthTo: string;   // YYYY-MM
    status: ('NOT_STARTED' | 'PRELIMINARY_CLOSED' | 'FINALIZED')[];
  };
  pagination: {
    page: number;
    size: number;
    sort: string;
    order: 'asc' | 'desc';
  };
  data: {
    items: MonthlyClosingItem[];
    totalCount: number;
    isLoading: boolean;
    error: Error | null;
  };
  refresh: {
    lastUpdated: Date;
    isRefreshing: boolean;
  };
}

interface MonthlyClosingItem {
  month: string;
  status: 'NOT_STARTED' | 'PRELIMINARY_CLOSED' | 'FINALIZED';
  totalEmployees: number;
  missingClockCount: number;
  pendingApprovalCount: number;
  flexDeficitCount: number;
  exportStatus: 'PROCESSING' | 'COMPLETED' | 'FAILED' | null;
  finalClosedAt: string | null;
}
```

---

## API連携

| 操作 | エンドポイント | メソッド | クエリパラメータ |
|------|--------------|---------|----------------|
| ダッシュボード取得 | `/api/v1/monthly-closings/dashboard` | GET | `monthFrom`, `monthTo`, `status`, `page`, `size`, `sort` |
| 仮締め実行 | `/api/v1/monthly-closings/actions/preliminary-close` | POST | Body: `{ month: "YYYY-MM" }` |
| 本締め実行 | `/api/v1/monthly-closings/actions/finalize` | POST | Body: `{ month: "YYYY-MM" }` |

---

## エラー処理

| エラー | 表示方法 | アクション |
|--------|---------|----------|
| 通信エラー | トースト（右上、赤） | 再試行ボタン |
| 認証エラー | リダイレクト | ログイン画面 |
| 仮締めNG | トースト + エラー詳細モーダル | 閉じる |
| 本締めNG | トースト + エラー詳細モーダル | 閉じる |
| 条件不足（本締め） | トースト「未打刻・未承認をすべて解消してください」 | - |

---

## レスポンシブ対応

| ブレークポイント | 対応 |
|----------------|------|
| Desktop (>1024px) | KPIカード横並び（5列）、フルテーブル表示 |
| Tablet (768-1024px) | KPIカード2列、テーブル一部カラム非表示（exportStatus, finalClosedAt） |
| Mobile (<768px) | KPIカード1列、テーブルは横スクロール |

---

## デザインガイドライン

### カラー＆テーマ

| 項目 | 値 | 備考 |
|------|-----|------|
| ベースカラー | #FFFFFF | ライトモード固定 |
| 背景 | #F9FAFB | 淡いグレー |
| アクセントカラー | #1F2937 | ダークグレー（ボタン） |
| セマンティック: Success | #10B981 | 確定・完了 |
| セマンティック: Warning | #F59E0B | 仮締め済・処理中 |
| セマンティック: Error | #EF4444 | 失敗・未解消 |
| セマンティック: Info | #3B82F6 | 処理中 |
| セマンティック: Neutral | #6B7280 | 未着手・未設定 |
| コントラスト比 | WCAG AA 準拠（4.5:1 以上） | テキスト/背景 |

### タイポグラフィ

| 要素 | フォント | サイズ | ウェイト |
|------|---------|--------|---------|
| 見出し（h1） | system-ui | 24px | 700 |
| 見出し（h2） | system-ui | 18px | 600 |
| 本文 | system-ui | 14px | 400 |
| ラベル | system-ui | 12px | 500 |
| 数値強調 | Roboto Mono | 18px | 700 |
| KPI値 | Roboto Mono | 28px | 700 |

### レイアウト原則

| 項目 | 値 |
|------|-----|
| 基本余白 | 8px グリッド |
| セクション間 | 24px |
| カード角丸 | 8px |
| ボタン角丸 | 6px |
| KPIカード影 | 0 1px 3px rgba(0,0,0,0.12) |
| 区切り線 | 1px solid #E5E7EB |
| KPIカード背景 | #FFFFFF |
| テーブル背景 | #FFFFFF |

### インタラクション

| 状態 | スタイル |
|------|---------|
| ホバー | 背景色変化（opacity: 0.08） |
| フォーカス | 2px outline #1F2937 + 2px offset |
| ローディング | Skeleton UI（グレーの矩形アニメーション） |
| 画面遷移 | 即時（アニメーションなし） |
| フィードバック | Toast 通知（右上、3秒自動消去） |
| ボタン無効 | opacity: 0.5 + cursor: not-allowed |

### アンチパターン（避けるべき表現）

- グラデーション背景の多用
- 装飾的なドロップシャドウの重ね掛け
- 無意味なアニメーション・トランジション
- ジェネリックなAI生成風のイラスト
- 過度な角丸（pill 形状の乱用）
- KPIカードの過度な装飾（clean-minimal優先）
- カラフルなチャート（mono-accentに従う）

---

<!-- メトリクスサマリー（/estimate 自動集計用）
画面種別: ダッシュボード
コンポーネント数: 22
DataTable: 1
SearchForm: 1
フォーム数: 1
チャート数: 0
KPIカード数: 5
-->
